<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.72">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="前端进阶导航(2021版) Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="前端进阶导航(2021版) Blog Atom Feed"><title data-react-helmet="true">015.精读 TC39 与 ECMAScript 提案 🦖 前端进阶导航(2021版)</title><meta data-react-helmet="true" property="og:url" content="https://coder-study-room.github.io/weekly/015"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-weekly-current"><meta data-react-helmet="true" property="og:title" content="015.精读 TC39 与 ECMAScript 提案 🦖 前端进阶导航(2021版)"><meta data-react-helmet="true" name="description" content="本期精读文章是：TC39, ECMAScript, and the Future of JavaScript"><meta data-react-helmet="true" property="og:description" content="本期精读文章是：TC39, ECMAScript, and the Future of JavaScript"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://coder-study-room.github.io/weekly/015"><link data-react-helmet="true" rel="alternate" href="https://coder-study-room.github.io/weekly/015" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://coder-study-room.github.io/weekly/015" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.f86f321e.css">
<link rel="preload" href="/assets/js/styles.dfb6e608.js" as="script">
<link rel="preload" href="/assets/js/runtime~main.4390b31f.js" as="script">
<link rel="preload" href="/assets/js/main.a607b355.js" as="script">
<link rel="preload" href="/assets/js/1.1d30cd56.js" as="script">
<link rel="preload" href="/assets/js/2.ea8a615f.js" as="script">
<link rel="preload" href="/assets/js/3.1e3c85ee.js" as="script">
<link rel="preload" href="/assets/js/1be78505.c98b55f0.js" as="script">
<link rel="preload" href="/assets/js/224.8da560f1.js" as="script">
<link rel="preload" href="/assets/js/cc953bd4.29f0345e.js" as="script">
<link rel="preload" href="/assets/js/17896441.21aede54.js" as="script">
<link rel="preload" href="/assets/js/1842b0fb.0ee7a239.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_2qcr"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="Front-end Advanced Route Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.svg" alt="Front-end Advanced Route Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">前端进阶导航(2021版)</strong></a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">前端学习</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/">前端进阶</a></li><li><a class="dropdown__link" href="/interview/">前端面试</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/weekly/">前端精读</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://juejin.cn/user/149189280672616/posts" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">掘金</a><a href="https://www.itdongdong.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">博客</a><a href="https://www.aliyun.com/minisite/goods?userCode=656jmlbm" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">阿里云2折</a><a href="https://github.com/coder-study-room/Front-end-Advanced-Route" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_GrZ2"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="Front-end Advanced Route Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.svg" alt="Front-end Advanced Route Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">前端进阶导航(2021版)</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">前端学习</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/">前端进阶</a></li><li class="menu__list-item"><a class="menu__link" href="/interview/">前端面试</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/weekly/">前端精读</a></li></ul></li><li class="menu__list-item"><a href="https://juejin.cn/user/149189280672616/posts" target="_blank" rel="noopener noreferrer" class="menu__link">掘金</a></li><li class="menu__list-item"><a href="https://www.itdongdong.com" target="_blank" rel="noopener noreferrer" class="menu__link">博客</a></li><li class="menu__list-item"><a href="https://www.aliyun.com/minisite/goods?userCode=656jmlbm" target="_blank" rel="noopener noreferrer" class="menu__link">阿里云2折</a></li><li class="menu__list-item"><a href="https://github.com/coder-study-room/Front-end-Advanced-Route" target="_blank" rel="noopener noreferrer" class="menu__link header-github-link" aria-label="GitHub repository"></a></li></ul></div></div></div></nav><div class="main-wrapper main-docs-wrapper"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo sidebarWithHideableNavbar_267A"><a tabindex="-1" class="sidebarLogo_3h0W" href="/"><img src="/img/logo.svg" alt="Front-end Advanced Route Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/logo.svg" alt="Front-end Advanced Route Logo" class="themedImage_1VuW themedImage--dark_hz6m"><strong>前端进阶导航(2021版)</strong></a><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">前端精读</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/">001.精读 js 模块化发展</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/002">002.精读模态框的最佳实践</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/003">003.精读前后端渲染之争</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/004">004.精读AsyncAwait优越之处</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/005">005.精读民工叔单页数据流方案</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/006">006.精读JavaScript错误堆栈处理</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/007">007.精读 请停止 css-in-js 的行为</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/008">008.精读入坑React前没有人会告诉你的事</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/009">009.精读 Immutable 结构共享</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/010">010.精读Web Components 的困境</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/011">011.精读前端调试技巧</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/012">012.精读 React 高阶组件</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/013">013.This 带来的困惑</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/014">014.精读架构设计之 DCI</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/weekly/015">015.精读 TC39 与 ECMAScript 提案</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/016">016.CSS Animations vs Web Animations API</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/017">017.精读《如何安全地使用 React context》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/018">018.精读《设计完美的日期选择器》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/019">019.精读《最佳前端面试题》及面试官技巧</a></li></ul></li></ul></div><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_1CGd"><svg width="20" height="20" role="img" class="collapseSidebarButtonIcon_3E-R"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">015.精读 TC39 与 ECMAScript 提案</h1></header><div class="markdown"><p>本期精读文章是：<a href="https://ponyfoo.com/articles/tc39-ecmascript-proposals-future-of-javascript" target="_blank" rel="noopener noreferrer">TC39, ECMAScript, and the Future of JavaScript</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="1-引言"></a>1 引言<a class="hash-link" href="#1-引言" title="Direct link to heading">#</a></h2><img src="/assets/15/juanzhou.png" alt="logo" width="500"><p>觉得 es6 es7 动不动就加新特性很烦？提案的讨论已经放开了，每个人都可以做 js 的主人，赶快与我一起了解下有哪些特性在日程中！</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="2-内容概要"></a>2 内容概要<a class="hash-link" href="#2-内容概要" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="tc39-是什么？包括哪些人？"></a>TC39 是什么？包括哪些人？<a class="hash-link" href="#tc39-是什么？包括哪些人？" title="Direct link to heading">#</a></h3><p>一个推动 JavaScript 发展的委员会，由各个主流浏览器厂商的代表构成。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="为什么会出现这样一个组织？"></a>为什么会出现这样一个组织？<a class="hash-link" href="#为什么会出现这样一个组织？" title="Direct link to heading">#</a></h3><p>从标准到落地是一个漫长的过程，相信大家上次阅读 web components 就能体会到标准到浏览器支持是一个漫长的过程。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="tc39-这群人主要的工作是什么？"></a>TC39 这群人主要的工作是什么？<a class="hash-link" href="#tc39-这群人主要的工作是什么？" title="Direct link to heading">#</a></h3><p>制定 ECMAScript 标准，标准生成的流程，并实现。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="标准的流程是什么样的？"></a>标准的流程是什么样的？<a class="hash-link" href="#标准的流程是什么样的？" title="Direct link to heading">#</a></h3><p>包括五个步骤：</p><ul><li>stage0 <code>strawman</code></li></ul><p>任何讨论、想法、改变或者还没加到提案的特性都在这个阶段。只有 TC39 成员可以提交。</p><ul><li><p>stage1 <code>proposal</code>
（1）产出一个正式的提案。
（2）发现潜在的问题，例如与其他特性的关系，实现难题。
（3）提案包括详细的 API 描述，使用例子，以及关于相关的语义和算法。</p></li><li><p>stage2 <code>draft</code>
（1）提供一个初始的草案规范，与最终标准中包含的特性不会有太大差别。草案之后，原则上只接受增量修改。
（2）开始实验如何实现，实现形式包括 polyfill, 实现引擎（提供草案执行本地支持），或者编译转换（例如 babel）</p></li><li><p>stage3 <code>candidate</code>
（1）候选阶段，获得具体实现和用户的反馈。此后，只有在实现和使用过程中出现了重大问题才会修改。
（1）规范文档必须是完整的，评审人和 ECMAScript 的编辑要在规范上签字。
（2）至少要在一个浏览器中实现，提供 polyfill 或者 babel 插件。</p></li><li><p>stage4 <code>finished</code>
（1）已经准备就绪，该特性会出现在下个版本的 ECMAScript 规范之中。。
（2）需要通过有 2 个独立的实现并通过验收测试，以获取使用过程中的重要实践经验。</p></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="一般可以去哪里查看-tc39-标准的进程呢？"></a>一般可以去哪里查看 TC39 标准的进程呢？<a class="hash-link" href="#一般可以去哪里查看-tc39-标准的进程呢？" title="Direct link to heading">#</a></h3><p>stage0 的提案 <a href="https://github.com/tc39/proposals/blob/master/stage-0-proposals.md" target="_blank" rel="noopener noreferrer">https://github.com/tc39/proposals/blob/master/stage-0-proposals.md</a>
stage1 - 4 的提案 <a href="https://github.com/tc39/proposals" target="_blank" rel="noopener noreferrer">https://github.com/tc39/proposals</a></p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="我们怎么在程序中应用这些新特性呢？"></a>我们怎么在程序中应用这些新特性呢？<a class="hash-link" href="#我们怎么在程序中应用这些新特性呢？" title="Direct link to heading">#</a></h3><p>babel 的插件：<code>babel-presets-stage-0</code> <code>babel-presets-stage-1</code> <code>babel-presets-stage-2</code> <code>babel-presets-stage-3</code> <code>babel-presets-stage-4</code></p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="3-精读"></a>3 精读<a class="hash-link" href="#3-精读" title="Direct link to heading">#</a></h2><p>本次提出独到观点的同学有：
<a href="https://github.com/huxiaoyun" target="_blank" rel="noopener noreferrer">@huxiaoyun</a> <a href="https://github.com/monkingxue" target="_blank" rel="noopener noreferrer">@monkingxue</a> <a href="https://github.com/jasonslyvia" target="_blank" rel="noopener noreferrer">@jasonslyvia</a> <a href="https://github.com/ascoders" target="_blank" rel="noopener noreferrer">@ascoders</a>，精读由此归纳。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="31-stage-4-大家庭"></a>3.1 Stage 4 大家庭<a class="hash-link" href="#31-stage-4-大家庭" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="arrayprototypeincludes"></a><a href="https://github.com/tc39/Array.prototype.includes/" target="_blank" rel="noopener noreferrer">Array.prototype.includes</a><a class="hash-link" href="#arrayprototypeincludes" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><div tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token function" style="color:rgb(111, 66, 193)">assert</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">includes</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">2</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">===</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(0, 92, 197)">true</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token function" style="color:rgb(111, 66, 193)">assert</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">includes</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">4</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">===</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(0, 92, 197)">false</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token function" style="color:rgb(111, 66, 193)">assert</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">NaN</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">includes</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">NaN</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">===</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(0, 92, 197)">true</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token function" style="color:rgb(111, 66, 193)">assert</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">-</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">includes</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token operator" style="color:rgb(0, 92, 197)">+</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">===</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(0, 92, 197)">true</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token function" style="color:rgb(111, 66, 193)">assert</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">+</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">includes</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token operator" style="color:rgb(0, 92, 197)">-</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">===</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(0, 92, 197)">true</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token function" style="color:rgb(111, 66, 193)">assert</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token string">&quot;a&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token string">&quot;b&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token string">&quot;c&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">includes</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">===</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(0, 92, 197)">true</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token function" style="color:rgb(111, 66, 193)">assert</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token string">&quot;a&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token string">&quot;b&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token string">&quot;c&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">includes</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">===</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(0, 92, 197)">false</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>这个 api 很方便，没有悬念的进入了草案中。</p><p>曾争议过是否使用 Array.prototype.contains，但由于 <a href="https://esdiscuss.org/topic/having-a-non-enumerable-array-prototype-contains-may-not-be-web-compatible" target="_blank" rel="noopener noreferrer">不兼容因素</a> 而换成了 includes。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="exponentiation-operator"></a><a href="https://github.com/rwaldron/exponentiation-operator" target="_blank" rel="noopener noreferrer">Exponentiation operator</a><a class="hash-link" href="#exponentiation-operator" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><div tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token comment" style="color:rgb(106, 153, 85)">// x ** y</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">let</span><span class="token plain"> squared </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">**</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// same as: 2 * 2</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">let</span><span class="token plain"> cubed </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">**</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// same as: 2 * 2 * 2</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>列表中进入了 stage4，但其 git 仓库 readme 还停留在 stage3。。</p><p>虽然已经有 <code>Math.pow</code> 了，但由于其他语言都支持此方式，js 也就支持了。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="objectvaluesobjectentries"></a><a href="https://github.com/tc39/proposal-object-values-entries" target="_blank" rel="noopener noreferrer">Object.values/Object.entries</a><a class="hash-link" href="#objectvaluesobjectentries" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><div tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token known-class-name class-name" style="color:rgb(227, 98, 9)">Object</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">values</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    a</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    b</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    c</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:rgb(227, 98, 9)">Symbol</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// [1, 2, Symbol()]</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token known-class-name class-name" style="color:rgb(227, 98, 9)">Object</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">entries</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    a</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    b</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    c</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:rgb(227, 98, 9)">Symbol</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// [[&quot;a&quot;, 1], [&quot;b&quot;, 2], [&quot;c&quot;, Symbol()]]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>也没有什么争议，Object.keys 都有了，获取 values、entries 也是合理的。</p><p>TC39 会议中有争辩过为何不返回迭代器，原因挺有意思，因为 Object.keys 返回的是数组，所以这两个 api 还是与老大哥统一吧。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="stringprototypepadstart--stringprototypepadend"></a><a href="https://github.com/tc39/proposal-string-pad-start-end" target="_blank" rel="noopener noreferrer">String.prototype.padStart / String.prototype.padEnd</a><a class="hash-link" href="#stringprototypepadstart--stringprototypepadend" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><div tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token string">&quot;foo&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">padStart</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">5</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token string">&quot;bar&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// bafoo</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token string">&quot;foo&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">padEnd</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">5</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token string">&quot;bar&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// fooba</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>解决了字符串补齐需求，很棒！</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="objectgetownpropertydescriptors"></a><a href="https://github.com/tc39/proposal-object-getownpropertydescriptors" target="_blank" rel="noopener noreferrer">Object.getOwnPropertyDescriptors</a><a class="hash-link" href="#objectgetownpropertydescriptors" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><div tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token known-class-name class-name" style="color:rgb(227, 98, 9)">Object</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">getOwnPropertyDescriptors</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> a</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// { a: {</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">//    configurable: true,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">//    enumberable: true,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">//    value: 1,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">//    writable: true</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// } }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>特别是 babel 与 typescript 处理 class property decorator 方式不同的时候（typescript 处理得更成熟一些），会导致 babel 处理装饰器时，成员变量不设置默认值时，configurable 默认为 false，通过这个函数检查变量的配置很方便。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="trailing-commas-in-function-parameter-lists-and-calls"></a><a href="https://github.com/tc39/proposal-trailing-function-commas" target="_blank" rel="noopener noreferrer">Trailing commas in function parameter lists and calls</a><a class="hash-link" href="#trailing-commas-in-function-parameter-lists-and-calls" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><div tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">clownPuppiesEverywhere</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">   param1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">   param2</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// Next parameter that&#x27;s added only has to add a new line, not modify this line</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">/* ... */</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>js 终于原生支持了，以前不支持的时候多加逗号还会报错，需要预编译工具删除最后一个逗号，现在终于名正言顺了。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="async-functions"></a><a href="https://github.com/tc39/ecmascript-asyncawait" target="_blank" rel="noopener noreferrer">Async functions</a><a class="hash-link" href="#async-functions" title="Direct link to heading">#</a></h4><p>这个不用多说了，都说好用。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="shared-memory-and-atomics"></a><a href="https://github.com/tc39/ecmascript_sharedmem" target="_blank" rel="noopener noreferrer">Shared memory and atomics</a><a class="hash-link" href="#shared-memory-and-atomics" title="Direct link to heading">#</a></h4><p>这是 ECMAScript 共享内存与 Atomics 的规范，涉及内容非常多，主要涉及到 asm.js。</p><p>asm.js 是一种性能解决方案，比如可以定义一个精确的 64k 堆：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><div tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">var</span><span class="token plain"> heap </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(227, 98, 9)">ArrayBuffer</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain"> </span><span class="token number">0x10000</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="lifting-template-literal-restriction"></a><a href="https://github.com/tc39/proposal-template-literal-revision" target="_blank" rel="noopener noreferrer">Lifting template literal restriction</a><a class="hash-link" href="#lifting-template-literal-restriction" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><div tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">styled</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">div</span><span class="token template-string template-punctuation string">`</span><span class="token template-string string"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token template-string string">  background-color: red;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token template-string string"></span><span class="token template-string template-punctuation string">`</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><code>styled.div = text =&gt; {}</code> 就可以处理了，目前使用最多在 styled-components 库里，这种场景还是蛮方便的。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="32-stage-3-大家庭"></a>3.2 Stage 3 大家庭<a class="hash-link" href="#32-stage-3-大家庭" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="functionprototypetostring-revision"></a><a href="https://github.com/tc39/Function-prototype-toString-revision" target="_blank" rel="noopener noreferrer">Function.prototype.toString revision</a><a class="hash-link" href="#functionprototypetostring-revision" title="Direct link to heading">#</a></h4><p>对函数的 toString 规则进行了修改：<a href="http://tc39.github.io/Function-prototype-toString-revision/#sec-function.prototype.tostring" target="_blank" rel="noopener noreferrer">http://tc39.github.io/Function-prototype-toString-revision/#sec-function.prototype.tostring</a></p><p>当调用内置函数或 <code>.bind</code> 后函数，toString 方法会返回 <a href="http://tc39.github.io/Function-prototype-toString-revision/#prod-NativeFunction" target="_blank" rel="noopener noreferrer">NativeFunction</a>。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="global"></a><a href="https://github.com/tc39/proposal-global" target="_blank" rel="noopener noreferrer">global</a><a class="hash-link" href="#global" title="Direct link to heading">#</a></h4><p>为 ECMAScript 规范添加 <code>global</code> 变量，同构代码再也不用这么写了：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><div tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">var</span><span class="token plain"> </span><span class="token function-variable function" style="color:rgb(111, 66, 193)">getGlobal</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">function</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// the only reliable means to get the global object is</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// `Function(&#x27;return this&#x27;)()`</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// However, this causes CSP violations in Chrome apps.</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#e3116c">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token keyword" style="color:#e3116c">typeof</span><span class="token plain"> self </span><span class="token operator" style="color:rgb(0, 92, 197)">!==</span><span class="token plain"> </span><span class="token string">&#x27;undefined&#x27;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#e3116c">return</span><span class="token plain"> self</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#e3116c">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token keyword" style="color:#e3116c">typeof</span><span class="token plain"> </span><span class="token dom variable" style="color:rgb(156, 220, 254)">window</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">!==</span><span class="token plain"> </span><span class="token string">&#x27;undefined&#x27;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#e3116c">return</span><span class="token plain"> </span><span class="token dom variable" style="color:rgb(156, 220, 254)">window</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#e3116c">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token keyword" style="color:#e3116c">typeof</span><span class="token plain"> global </span><span class="token operator" style="color:rgb(0, 92, 197)">!==</span><span class="token plain"> </span><span class="token string">&#x27;undefined&#x27;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#e3116c">return</span><span class="token plain"> global</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#e3116c">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(227, 98, 9)">Error</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&#x27;unable to locate global object&#x27;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>虽然前端环境与 nodejs 区别很大，但既然提案进入了 stage3，说明大家非常关注 js 整体的生态，只要整体方向良性发展，相信不久将会进入 stage4。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="restspread-properties"></a><a href="https://github.com/tc39/proposal-object-rest-spread" target="_blank" rel="noopener noreferrer">Rest/Spread Properties</a><a class="hash-link" href="#restspread-properties" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><div tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">let</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token spread operator" style="color:rgb(0, 92, 197)">...</span><span class="token plain">z </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> x</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> y</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> a</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> b</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token number">4</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">x</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// 1</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">y</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// 2</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">z</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// { a: 3, b: 4 }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>不得不说，非常常用，而且 <a href="https://babeljs.io/docs/plugins/transform-object-rest-spread/" target="_blank" rel="noopener noreferrer">babel</a>，<a href="https://github.com/facebookarchive/jstransform" target="_blank" rel="noopener noreferrer">jsTransform</a>，<a href="https://github.com/Microsoft/TypeScript" target="_blank" rel="noopener noreferrer">typescript</a> 均支持，感觉很快会进入 stage4.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="asynchronous-iteration"></a><a href="https://github.com/tc39/proposal-async-iteration" target="_blank" rel="noopener noreferrer">Asynchronous Iteration</a><a class="hash-link" href="#asynchronous-iteration" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><div tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> done </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> syncIterator</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">next</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">asyncIterator</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">next</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">then</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token parameter"> value</span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token parameter"> done </span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(0, 92, 197)">=&gt;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">/* ... */</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><div tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword control-flow" style="color:#e3116c">for</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#e3116c">await</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> line </span><span class="token keyword" style="color:#e3116c">of</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">readLines</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">filePath</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token console class-name" style="color:rgb(227, 98, 9)">console</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">log</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">line</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><div tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">async</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">function</span><span class="token operator" style="color:rgb(0, 92, 197)">*</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">readLines</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token parameter">path</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token keyword" style="color:#e3116c">let</span><span class="token plain"> file </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#e3116c">await</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">fileOpen</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">path</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#e3116c">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#e3116c">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token operator" style="color:rgb(0, 92, 197)">!</span><span class="token plain">file</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token constant" style="color:rgb(100, 102, 149)">EOF</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#e3116c">yield</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#e3116c">await</span><span class="token plain"> file</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">readLine</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#e3116c">finally</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#e3116c">await</span><span class="token plain"> file</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">close</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>异步迭代器实现了 async await 与 generator 的结合。
然而 async await 是使用 generator 的语法糖，generator 也可以通过 switch 等流程控制函数模拟。更重要的是异步在 generator 中本身就可以实现，我在<a href="https://github.com/ascoders/blog/issues/14" target="_blank" rel="noopener noreferrer">《Callback Promise Generator Async-Await 和异常处理的演进》</a> 文章中提过。</p><p>语法的修改一定不能为了方便（在 ECMAScript 中可能出现），但这种混杂的方式容易让人混淆 await 与 generator 之间的关系，是否进入 stage4 还需仔细斟酌。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="import"></a><a href="https://github.com/tc39/proposal-dynamic-import" target="_blank" rel="noopener noreferrer">import()</a><a class="hash-link" href="#import" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><div tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword module" style="color:#e3116c">import</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">./section-modules/</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(36, 41, 46)">${</span><span class="token template-string interpolation">link</span><span class="token template-string interpolation punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token template-string interpolation">dataset</span><span class="token template-string interpolation punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token template-string interpolation">entryModule</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token template-string string">.js</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">then</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token parameter">module</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(0, 92, 197)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      module</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">loadPageInto</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">main</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token keyword control-flow" style="color:#e3116c">catch</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token parameter">err</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(0, 92, 197)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      main</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">textContent</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> err</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">message</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>这个提案主要增加了函数调用版的 import，而 webpack 等构建工具也在积极实现此规范，并作为动态加载的最佳范例。希望这种“官方 Amd”可以早日加入草案。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="regexp-lookbehind-assertions"></a><a href="https://github.com/tc39/proposal-regexp-lookbehind" target="_blank" rel="noopener noreferrer">RegExp Lookbehind Assertions</a><a class="hash-link" href="#regexp-lookbehind-assertions" title="Direct link to heading">#</a></h4><p>javascript 正则表达式一直不支持后行断言，不过现在已经进入 stage3，相信不久会进入 stage4.</p><p>前向断言：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><div tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">\d+(?=%)</span><span class="token regex regex-delimiter">/</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">exec</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;100% of US presidents have been male&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// [&quot;100&quot;]</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 92, 197)">/</span><span class="token plain">\d</span><span class="token operator" style="color:rgb(0, 92, 197)">+</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token operator" style="color:rgb(0, 92, 197)">?</span><span class="token operator" style="color:rgb(0, 92, 197)">!</span><span class="token operator" style="color:rgb(0, 92, 197)">%</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token operator" style="color:rgb(0, 92, 197)">/</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">exec</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;that’s all 44 of them&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// [&quot;44&quot;]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>后向断言：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><div tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">(?&lt;=\$)\d+</span><span class="token regex regex-delimiter">/</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">exec</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Benjamin Franklin is on the $100 bill&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// [&quot;100&quot;]</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 92, 197)">/</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token operator" style="color:rgb(0, 92, 197)">?</span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;</span><span class="token operator" style="color:rgb(0, 92, 197)">!</span><span class="token plain">\$</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain">\d</span><span class="token operator" style="color:rgb(0, 92, 197)">+</span><span class="token operator" style="color:rgb(0, 92, 197)">/</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">exec</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;it’s is worth about €90&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain">                </span><span class="token comment" style="color:rgb(106, 153, 85)">// [&quot;90&quot;]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>后向断言会获取某个字符后面跟的内容，在获取美刀等货币单位上有很大用途。chrome 可以使用 <code>chrome.exe --js-flags=&quot;--harmony-regexp-lookbehind&quot;</code> 命令开启。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="regexp-unicode-property-escapes"></a><a href="https://github.com/tc39/proposal-regexp-unicode-property-escapes" target="_blank" rel="noopener noreferrer">RegExp Unicode Property Escapes</a><a class="hash-link" href="#regexp-unicode-property-escapes" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><div tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> regexGreekSymbol </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">\p{Script=Greek}</span><span class="token regex regex-delimiter">/</span><span class="token regex regex-flags">u</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">regexGreekSymbol</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">test</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&#x27;π&#x27;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// → true</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>以上 <code>π</code> 字符是一个希腊字符，通过指定 <code>\p{Script=Greek}</code> 就可以匹配这个字符了！</p><p>虽然可以通过引用希腊字符（或者其他编码）表做正则处理，当每当更新表时，更新起来会非常麻烦，不如让浏览器原生支持 <code>\p{UnicodePropertyName=UnicodePropertyValue}</code> 的正则语法，帮助开发人员解决这个烦恼。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="regexp-named-capture-groups"></a><a href="https://github.com/tc39/proposal-regexp-named-groups" target="_blank" rel="noopener noreferrer">RegExp named capture groups</a><a class="hash-link" href="#regexp-named-capture-groups" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><div tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">let</span><span class="token plain"> re </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">(?&lt;year&gt;\d{4})-(?&lt;month&gt;\d{2})-(?&lt;day&gt;\d{2})</span><span class="token regex regex-delimiter">/</span><span class="token regex regex-flags">u</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">let</span><span class="token plain"> result </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> re</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">exec</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&#x27;2015-01-02&#x27;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// result.groups.year === &#x27;2015&#x27;;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// result.groups.month === &#x27;01&#x27;;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// result.groups.day === &#x27;02&#x27;;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// result[0] === &#x27;2015-01-02&#x27;;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// result[1] === &#x27;2015&#x27;;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// result[2] === &#x27;01&#x27;;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// result[3] === &#x27;02&#x27;;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><div tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">let</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain">groups</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain">one</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> two</span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">^(?&lt;one&gt;.*):(?&lt;two&gt;.*)$</span><span class="token regex regex-delimiter">/</span><span class="token regex regex-flags">u</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">exec</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&#x27;foo:bar&#x27;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token console class-name" style="color:rgb(227, 98, 9)">console</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">log</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">one: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(36, 41, 46)">${</span><span class="token template-string interpolation">one</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token template-string string">, two: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(36, 41, 46)">${</span><span class="token template-string interpolation">two</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// prints one: foo, two: bar</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>同时，还支持 <strong>反向引用能力</strong>，可以通过 <code>\k&lt;name&gt;</code> 的语法，在正则中表示同一种匹配类型，这个和 ts 范型很像：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><div tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">let</span><span class="token plain"> duplicate </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">^(?&lt;half&gt;.*).\k&lt;half&gt;$</span><span class="token regex regex-delimiter">/</span><span class="token regex regex-flags">u</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">duplicate</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">test</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&#x27;a*b&#x27;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// false</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">duplicate</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">test</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&#x27;a*a&#x27;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// true</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>总体来看非常给力，毫无意义的下标也是正则反人类的原因之一，这个提案通过的话，正则会变得更加可读。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="s-dotall-flag-for-regular-expressions"></a><a href="https://github.com/tc39/proposals" target="_blank" rel="noopener noreferrer">s (dotAll) flag for regular expressions</a><a class="hash-link" href="#s-dotall-flag-for-regular-expressions" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><div tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">foo.bar</span><span class="token regex regex-delimiter">/</span><span class="token regex regex-flags">s</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">test</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&#x27;foo\nbar&#x27;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// → true</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>通过添加了新的标识符 <code>/s</code>，表示 <code>.</code> 这个标志可以匹配任何值。原因是觉得现在正则的做法比较反人类：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><div tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">foo[^]bar</span><span class="token regex regex-delimiter">/</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">test</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&#x27;foo\nbar&#x27;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// → true</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 92, 197)">/</span><span class="token plain">foo</span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain">\s\</span><span class="token constant" style="color:rgb(100, 102, 149)">S</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token plain">bar</span><span class="token operator" style="color:rgb(0, 92, 197)">/</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">test</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&#x27;foo\nbar&#x27;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// → true</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>从保守派角度来看，可能因为掌握了 <code>[^]</code> <code>[\s\S]</code> 这种奇技淫巧而沾沾自喜，借此提高正则的门槛，让初学者“看不懂”，而高级语言的第一要义是可读性，<code>RegExp Unicode Property Escapes</code> 与 <code>RegExp named capture groups</code> 进入草案就是表明了对正则语义化改进的决心，相信这个提案也会被采纳。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="legacy-regexp-features-in-javascript"></a><a href="https://github.com/tc39/proposal-regexp-legacy-features" target="_blank" rel="noopener noreferrer">Legacy RegExp features in JavaScript</a><a class="hash-link" href="#legacy-regexp-features-in-javascript" title="Direct link to heading">#</a></h4><p>该提案主要针对 RegExp 遗留的静态属性进行梳理。平时很少接触，希望了解的人解读一下。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="33-stage2-大家庭"></a>3.3 Stage2 大家庭<a class="hash-link" href="#33-stage2-大家庭" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="functionsent-metaproperty"></a><a href="https://github.com/allenwb/ESideas/blob/master/Generator%20metaproperty.md" target="_blank" rel="noopener noreferrer">function.sent metaproperty</a><a class="hash-link" href="#functionsent-metaproperty" title="Direct link to heading">#</a></h4><p>generator 的第一个 <code>.next</code> 参数会被抛弃，因为第一次 next 没有对应上任何 <code>yield</code>，如下代码就会产生疑惑：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><div tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">function</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">*</span><span class="token function" style="color:rgb(111, 66, 193)">adder</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token parameter">total</span><span class="token parameter operator" style="color:rgb(0, 92, 197)">=</span><span class="token parameter number">0</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">   </span><span class="token keyword" style="color:#e3116c">let</span><span class="token plain"> increment</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">   </span><span class="token keyword control-flow" style="color:#e3116c">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token boolean" style="color:rgb(0, 92, 197)">true</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token keyword control-flow" style="color:#e3116c">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">request </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#e3116c">yield</span><span class="token plain"> total </span><span class="token operator" style="color:rgb(0, 92, 197)">+=</span><span class="token plain"> increment</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">          </span><span class="token keyword" style="color:#e3116c">case</span><span class="token plain"> </span><span class="token keyword nil" style="color:#e3116c">undefined</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#e3116c">break</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">          </span><span class="token keyword" style="color:#e3116c">case</span><span class="token plain"> </span><span class="token string">&quot;done&quot;</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#e3116c">return</span><span class="token plain"> total</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">          </span><span class="token keyword module" style="color:#e3116c">default</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> increment </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:rgb(227, 98, 9)">Number</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">request</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">let</span><span class="token plain"> tally </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">adder</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">tally</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">next</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">0.1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// argument will be ignored</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">tally</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">next</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">0.1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">tally</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">next</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">0.1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">let</span><span class="token plain"> last</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">tally</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">next</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;done&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token console class-name" style="color:rgb(227, 98, 9)">console</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">log</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">last</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">value</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">//1.2 instead of 0.3</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>当引入 <code>function.sent</code> 后，可以接收来自 next 的传值，<strong>包括初始传值</strong>：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><div tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">function</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">*</span><span class="token function" style="color:rgb(111, 66, 193)">adder</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token parameter">total</span><span class="token parameter operator" style="color:rgb(0, 92, 197)">=</span><span class="token parameter number">0</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">   </span><span class="token keyword" style="color:#e3116c">let</span><span class="token plain"> increment</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">   </span><span class="token keyword control-flow" style="color:#e3116c">do</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token keyword control-flow" style="color:#e3116c">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function-variable function" style="color:rgb(111, 66, 193)">request</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">function</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">sent</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">          </span><span class="token keyword" style="color:#e3116c">case</span><span class="token plain"> </span><span class="token keyword nil" style="color:#e3116c">undefined</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#e3116c">break</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">          </span><span class="token keyword" style="color:#e3116c">case</span><span class="token plain"> </span><span class="token string">&quot;done&quot;</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#e3116c">return</span><span class="token plain"> total</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">          </span><span class="token keyword module" style="color:#e3116c">default</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> increment </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:rgb(227, 98, 9)">Number</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">request</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">       </span><span class="token keyword control-flow" style="color:#e3116c">yield</span><span class="token plain"> total </span><span class="token operator" style="color:rgb(0, 92, 197)">+=</span><span class="token plain"> increment</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#e3116c">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token boolean" style="color:rgb(0, 92, 197)">true</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">let</span><span class="token plain"> tally </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">adder</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">tally</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">next</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">0.1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// argument no longer ignored</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">tally</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">next</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">0.1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">tally</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">next</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">0.1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">let</span><span class="token plain"> last</span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain">tally</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">next</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;done&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token console class-name" style="color:rgb(227, 98, 9)">console</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">log</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">last</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">value</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">//0.3</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>这是个很棒的特性，也不存在语意兼容问题，但 api 还是比较怪，而且自此 yield 接收参数也变得没有意义，况且如今 async await 逐渐成为主流，这种修正没有强烈刚需。而且 yield 的语意本身没有错误，这个提案比较危险。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="stringprototypetrimstarttrimend"></a><a href="https://github.com/tc39/proposal-string-left-right-trim" target="_blank" rel="noopener noreferrer">String.prototype.{trimStart,trimEnd}</a><a class="hash-link" href="#stringprototypetrimstarttrimend" title="Direct link to heading">#</a></h4><p>既然 <code>padStart</code> 与 <code>padEnd</code> 都进入了 stage4，<code>trimStart</code> <code>trimEnd</code> 这两个 api 也非常常用，而且从 ES5 将 <code>String.prototype.trim</code> 引入了标准来看，这两个非常有望晋升到 stage3。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="class-fields"></a><a href="https://github.com/tc39/proposal-class-fields" target="_blank" rel="noopener noreferrer">Class Fields</a><a class="hash-link" href="#class-fields" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><div tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(227, 98, 9)">Counter</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">extends</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(227, 98, 9)">HTMLElement</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  x </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  #y </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>类成员变量，有了它 js 就完整了。虽然觉得似有变量符号很难看，但成员变量绝对是非常有用的语法，在 react 中已经很常用了：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><div tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(227, 98, 9)">Todo</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">extends</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(227, 98, 9)">React</span><span class="token class-name punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token class-name" style="color:rgb(227, 98, 9)">Component</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  state </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">//.. }</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="promiseprototypefinally"></a><a href="https://github.com/tc39/proposal-promise-finally" target="_blank" rel="noopener noreferrer">Promise.prototype.finally</a><a class="hash-link" href="#promiseprototypefinally" title="Direct link to heading">#</a></h4><p>就像 <code>try/catch/finally</code> 一样，try return 了都能执行 finally，是非常方便的，对 promise 来说也是如此，<a href="https://github.com/petkaantonov/bluebird" target="_blank" rel="noopener noreferrer">bluebird</a> <a href="https://github.com/kriskowal/q/wiki/API-Reference#promisefinallycallback" target="_blank" rel="noopener noreferrer">Q</a> 等库已经实现了此功能。</p><p>但是库实现不足以使其纳入标准，只有当这些需求足够常用和通用时才会考虑。第三方库可能从竞争力角度考虑，多支持一种功能、少些一行代码就是多一份筹码，但语言规范是不能在乎这些的。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="class-and-property-decorators"></a><a href="http://tc39.github.io/proposal-decorators/" target="_blank" rel="noopener noreferrer">Class and Property Decorators</a><a class="hash-link" href="#class-and-property-decorators" title="Direct link to heading">#</a></h4><p>类级别的装饰器已经进入 stage2 了，但现代前端开发中已经非常常用，很可能会进一步进入 stage3.</p><p>如果这个提案被废弃，那么大部分现代 js 代码将面临大量使用不存在语法的窘境。不过乐观的是，目前还找不到更好的装饰器替代方案，而在 python 中也存在装饰器模式可以参考。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="intlsegmenter"></a><a href="https://github.com/tc39/proposal-intl-segmenter" target="_blank" rel="noopener noreferrer">Intl.Segmenter</a><a class="hash-link" href="#intlsegmenter" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><div tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token comment" style="color:rgb(106, 153, 85)">// Create a segmenter in your locale</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">let</span><span class="token plain"> segmenter </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(227, 98, 9)">Intl</span><span class="token class-name punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token class-name" style="color:rgb(227, 98, 9)">Segmenter</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;fr&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain">granularity</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token string">&quot;word&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Get an iterator over a string</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">let</span><span class="token plain"> iterator </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> segmenter</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">segment</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Ceci n&#x27;est pas une pipe&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Iterate over it!</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword control-flow" style="color:#e3116c">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token keyword" style="color:#e3116c">let</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain">segment</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> breakType</span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">of</span><span class="token plain"> iterator</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token console class-name" style="color:rgb(227, 98, 9)">console</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">log</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">segment: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(36, 41, 46)">${</span><span class="token template-string interpolation">segment</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token template-string string"> breakType: </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(36, 41, 46)">${</span><span class="token template-string interpolation">breakType</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#e3116c">break</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// logs the following to the console:</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// segment: Ceci breakType: letter</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><code>Intl.Segmenter</code> 可以帮助分析单词断句分析，可能在 nlp 领域比较有用，在文本编辑器自动选中功能中也很有用。</p><p>虽然不是刚需，但 js 作为网页交互的语言，确实需要解决分析用户输入的问题。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="arbitrary-precision-integers"></a><a href="https://github.com/tc39/proposal-bigint" target="_blank" rel="noopener noreferrer">Arbitrary-precision Integers</a><a class="hash-link" href="#arbitrary-precision-integers" title="Direct link to heading">#</a></h4><p>新增了基本类型：整数类型，以及 Integer api 与字面语法 1234n。</p><p>目前 js 使用 64 位浮点数处理所有计算，直接导致了运算效率低下，这个提案弥补了 js 的计算缺点，希望可以早日进入草案。</p><p>提案名称由 Integer 改为 BigInt。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="importmeta"></a><a href="https://github.com/tc39/proposals" target="_blank" rel="noopener noreferrer">import.meta</a><a class="hash-link" href="#importmeta" title="Direct link to heading">#</a></h4><p>提出了使用 <code>import.meta</code> 获取当前模块的域信息。类比 nodejs 存在 <code>__dirname</code> 等信息标志当前脚本信息，通过浏览器加载的模块也应当拥有这种能力。</p><p>目前 js 可以通过如下方式获取脚本信息：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><div tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> theOption </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token dom variable" style="color:rgb(156, 220, 254)">document</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">currentScript</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">dataset</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">option</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>这样污染了全局变量，脚本信息应当存储在脚本作用域中，因此提案希望将脚本信息存储在脚本的 <code>import.meta</code>  变量中，因此可以这么使用：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><div tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token keyword" style="color:#e3116c">async</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(0, 92, 197)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> response </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#e3116c">await</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">fetch</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token keyword" style="color:#e3116c">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(227, 98, 9)">URL</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;../hamsters.jpg&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token keyword module" style="color:#e3116c">import</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">meta</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">url</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> blob </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#e3116c">await</span><span class="token plain"> response</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">blob</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> size </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token keyword module" style="color:#e3116c">import</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">meta</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">scriptElement</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">dataset</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">size</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">||</span><span class="token plain"> </span><span class="token number">300</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> image </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(227, 98, 9)">Image</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  image</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">src</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">URL</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">createObjectURL</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">blob</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  image</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">width</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> image</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">height</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> size</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token dom variable" style="color:rgb(156, 220, 254)">document</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">body</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">appendChild</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">image</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="34-stage1-大家庭"></a>3.4 Stage1 大家庭<a class="hash-link" href="#34-stage1-大家庭" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="dateparse-fallback-semantics"></a><a href="https://github.com/FaustDeGoethe/proposal-date-time-string-format" target="_blank" rel="noopener noreferrer">Date.parse fallback semantics</a><a class="hash-link" href="#dateparse-fallback-semantics" title="Direct link to heading">#</a></h4><p>通过字符串格式化日期一直是跨浏览器的痛点，本提案希望通过新增 <code>Date.parse</code> 标准完成这个功能。</p><blockquote><p>&quot;The function first attempts to parse the format of the String according to the rules
(including extended years) called out in Date Time String Format (20.3.1.16). If the
String does not conform to that format the function may fall back to any
implementation-specific heuristics or implementation-specific date formats.&quot;</p></blockquote><p>正如提案所说，“如果字符串不满足  ISO 8601 格式，可以返回你想返回的任何值” 这样迷惑开发者是没有任何意义的，这样只会让开发者越来越不相信 js 是跨平台的语言。</p><p>这么重要的规范居然才 stage1，必须要顶上去。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="export--as-ns-from-mod-statements"></a><a href="https://github.com/tc39/proposal-export-ns-from" target="_blank" rel="noopener noreferrer">export * as ns from &quot;mod&quot;; statements</a><a class="hash-link" href="#export--as-ns-from-mod-statements" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><div tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword module" style="color:#e3116c">export</span><span class="token plain"> </span><span class="token exports operator" style="color:rgb(0, 92, 197)">*</span><span class="token exports"> </span><span class="token exports keyword module" style="color:#e3116c">as</span><span class="token exports"> someIdentifier</span><span class="token plain"> </span><span class="token keyword module" style="color:#e3116c">from</span><span class="token plain"> </span><span class="token string">&quot;someModule&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>很方便的 api，很多时候希望导出某个模块的全部接口，又不希望命名冲突，可以少写一行 import。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="export-v-from-mod-statements"></a><a href="https://github.com/tc39/proposal-export-default-from" target="_blank" rel="noopener noreferrer">export v from &quot;mod&quot;; statements</a><a class="hash-link" href="#export-v-from-mod-statements" title="Direct link to heading">#</a></h4><p>这个提案与 <a href="https://github.com/tc39/proposal-export-ns-from" target="_blank" rel="noopener noreferrer">export * as ns from &quot;mod&quot;; statements</a>
冲突了，感觉 <a href="https://github.com/tc39/proposal-export-ns-from" target="_blank" rel="noopener noreferrer">export * as ns from &quot;mod&quot;; statements</a>
提案更清晰一些。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="observable"></a><a href="https://github.com/tc39/proposal-observable" target="_blank" rel="noopener noreferrer">Observable</a><a class="hash-link" href="#observable" title="Direct link to heading">#</a></h4><p>可观察类型可以从 dom 事件、轮询等触发事件中创建监听并订阅：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><div tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">listen</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token parameter">element</span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token parameter"> eventName</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#e3116c">return</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(227, 98, 9)">Observable</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token parameter">observer</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(0, 92, 197)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)">// Create an event handler which sends data to the sink</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        </span><span class="token keyword" style="color:#e3116c">let</span><span class="token plain"> </span><span class="token function-variable function" style="color:rgb(111, 66, 193)">handler</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token parameter">event</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(0, 92, 197)">=&gt;</span><span class="token plain"> observer</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">next</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">event</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)">// Attach the event handler</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        element</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">addEventListener</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">eventName</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> handler</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(0, 92, 197)">true</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        </span><span class="token comment" style="color:rgb(106, 153, 85)">// Return a cleanup function which will cancel the event stream</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#e3116c">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(0, 92, 197)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            </span><span class="token comment" style="color:rgb(106, 153, 85)">// Detach the event handler from the element</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">            element</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">removeEventListener</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">eventName</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> handler</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(0, 92, 197)">true</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Return an observable of special key down commands</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">commandKeys</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token parameter">element</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token keyword" style="color:#e3116c">let</span><span class="token plain"> keyCommands </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token string">&quot;38&quot;</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token string">&quot;up&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token string">&quot;40&quot;</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token string">&quot;down&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#e3116c">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">listen</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">element</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token string">&quot;keydown&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">filter</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token parameter">event</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(0, 92, 197)">=&gt;</span><span class="token plain"> event</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">keyCode</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">in</span><span class="token plain"> keyCommands</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">map</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token parameter">event</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(0, 92, 197)">=&gt;</span><span class="token plain"> keyCommands</span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain">event</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">keyCode</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">let</span><span class="token plain"> subscription </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">commandKeys</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">inputElement</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">subscribe</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token function" style="color:rgb(111, 66, 193)">next</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token parameter">val</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token console class-name" style="color:rgb(227, 98, 9)">console</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">log</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Received key command: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">+</span><span class="token plain"> val</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token function" style="color:rgb(111, 66, 193)">error</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token parameter">err</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token console class-name" style="color:rgb(227, 98, 9)">console</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">log</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Received an error: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">+</span><span class="token plain"> err</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token function" style="color:rgb(111, 66, 193)">complete</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token console class-name" style="color:rgb(227, 98, 9)">console</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">log</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Stream complete&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>这个名字和 Object.observe 很像，不过没什么关系。该功能已经被 <a href="https://github.com/ReactiveX/RxJS" target="_blank" rel="noopener noreferrer">RxJS</a>、<a href="https://github.com/staltz/xstream" target="_blank" rel="noopener noreferrer">XStream</a> 等库实现。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="stringmatchall"></a><a href="https://github.com/tc39/String.prototype.matchAll" target="_blank" rel="noopener noreferrer">String#matchAll</a><a class="hash-link" href="#stringmatchall" title="Direct link to heading">#</a></h4><p>目前正则表达式想要匹配全部的语法不够语义化，提案希望通过 <code>matchAll</code> 返回迭代器来遍历匹配结果，很赞！</p><p>现在匹配全部只能使用 <code>while ((result = patt.exec(str)) != null)</code> 这种方式遍历，不优雅。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="weakrefs"></a><a href="https://github.com/tc39/proposal-weakrefs" target="_blank" rel="noopener noreferrer">WeakRefs</a><a class="hash-link" href="#weakrefs" title="Direct link to heading">#</a></h4><p>弱引用，提案地址文档：<a href="https://github.com/tc39/proposal-weakrefs/blob/master/specs/Weak%20References%20for%20EcmaScript.pdf" target="_blank" rel="noopener noreferrer">https://github.com/tc39/proposal-weakrefs/blob/master/specs/Weak%20References%20for%20EcmaScript.pdf</a></p><p>有点像 OC 的弱引用，当对象被释放时，当前持有弱引用的对象也会被 GC 回收，但似乎还没有开始讨论，js 越来越底层了？</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="frozen-realms"></a><a href="https://github.com/FUDCo/frozen-realms" target="_blank" rel="noopener noreferrer">Frozen Realms</a><a class="hash-link" href="#frozen-realms" title="Direct link to heading">#</a></h4><p>增强了 <a href="https://github.com/tc39/proposal-realms" target="_blank" rel="noopener noreferrer">Realms</a> 提案，利用不可变结构，实现结构共享。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="math-extensions"></a><a href="https://github.com/rwaldron/proposal-math-extensions" target="_blank" rel="noopener noreferrer">Math Extensions</a><a class="hash-link" href="#math-extensions" title="Direct link to heading">#</a></h4><p>Math 函数的拓展包含的函数：<a href="https://rwaldron.github.io/proposal-math-extensions/" target="_blank" rel="noopener noreferrer">https://rwaldron.github.io/proposal-math-extensions/</a></p><p>这个函数拓展很给力，特别是设计游戏，计算角度的时候：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><div tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token known-class-name class-name" style="color:rgb(227, 98, 9)">Math</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token constant" style="color:rgb(100, 102, 149)">DEG_PER_RAD</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// Math.PI / 180</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><code>Math.DEG_PER_RAD</code> 是一种单位，让角度可以用 0～360 为周期的数字表示，比如射击子弹时的角度、或者做可视化时都非常有用，类比 css 中的：<code>transform: rotate(180deg);</code>。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="of-and-from-on-collection-constructors"></a><a href="https://github.com/tc39/proposal-setmap-offrom" target="_blank" rel="noopener noreferrer">of and from on collection constructors</a><a class="hash-link" href="#of-and-from-on-collection-constructors" title="Direct link to heading">#</a></h4><p>该提案设计了 Set、Map 类型的 <code>of</code> <code>from</code> 方法，具体见此：<a href="https://tc39.github.io/proposal-setmap-offrom/" target="_blank" rel="noopener noreferrer">https://tc39.github.io/proposal-setmap-offrom/</a></p><p>问题由于:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><div tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token known-class-name class-name" style="color:rgb(227, 98, 9)">Reflect</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">construct</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token known-class-name class-name" style="color:rgb(227, 98, 9)">Array</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token number">2</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token number">3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// [1,2,3]</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token known-class-name class-name" style="color:rgb(227, 98, 9)">Reflect</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">construct</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token known-class-name class-name" style="color:rgb(227, 98, 9)">Set</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token number">2</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token number">3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// Uncaught TypeError: undefined is not a function</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>因为 Set 接收的参数是数组，而 construct 会调用 <code>CreateListFromArrayLike</code> 将参数打平，变成了 <code>new Set(1, 2, 3)</code> 传入，实际上是语法错误的，因此作者提议新增下 Set、Map 的 <code>of</code> <code>from</code> 方法。</p><p>Set、Map 在国内环境用的比较少，也很少有人计较这个问题，不过从技术角度来看，确实需要修复。。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="generator-arrow-functions-"></a><a href="https://esdiscuss.org/topic/generator-arrow-functions" target="_blank" rel="noopener noreferrer">Generator arrow functions (=&gt;*)</a><a class="hash-link" href="#generator-arrow-functions-" title="Direct link to heading">#</a></h4><p>还是挺有必要的，毕竟都出箭头函数了，也要支持一下箭头函数的 generator 语法。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="promisetry"></a><a href="https://github.com/tc39/proposal-promise-try" target="_blank" rel="noopener noreferrer">Promise.try</a><a class="hash-link" href="#promisetry" title="Direct link to heading">#</a></h4><p>同理，各大库都有实现，好处是所有错误都可以通过 <code>.catch</code> 捕获，而不用担心同步、异步错误的抛出。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="null-propagation"></a><a href="https://docs.google.com/presentation/d/11O_wIBBbZgE1bMVRJI8kGnmC6dWCBOwutbN9SWOK0fU/view#slide=id.p" target="_blank" rel="noopener noreferrer">Null Propagation</a><a class="hash-link" href="#null-propagation" title="Direct link to heading">#</a></h4><p>超级有用，看代码就知道了：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><div tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> firstName </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> message</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">body</span><span class="token operator" style="color:rgb(0, 92, 197)">?.</span><span class="token plain">user</span><span class="token operator" style="color:rgb(0, 92, 197)">?.</span><span class="token plain">firstName </span><span class="token operator" style="color:rgb(0, 92, 197)">||</span><span class="token plain"> </span><span class="token string">&#x27;default&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>该功能完全等同：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><div tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> firstName </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">message </span><span class="token operator" style="color:rgb(0, 92, 197)">&amp;&amp;</span><span class="token plain"> </span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    message</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">body</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">&amp;&amp;</span><span class="token plain"> </span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    message</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">body</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">user</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">&amp;&amp;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    message</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">body</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">user</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">firstName</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">||</span><span class="token plain"> </span><span class="token string">&#x27;default&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>希望立刻进入 stage4.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="mathsignbit-ieee-754-sign-bit"></a><a href="http://jfbastien.github.io/papers/Math.signbit.html" target="_blank" rel="noopener noreferrer">Math.signbit: IEEE-754 sign bit</a><a class="hash-link" href="#mathsignbit-ieee-754-sign-bit" title="Direct link to heading">#</a></h4><p>当值为 负数 或 -0 时返回 <code>true</code>。由于 <code>Math.sign</code> 不区分 +0 与 -0，因此提案建议增加此函数，而且此函数在 c、c++、go 语言都有实现。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="error-stacks"></a><a href="https://github.com/tc39/proposal-error-stacks" target="_blank" rel="noopener noreferrer">Error stacks</a><a class="hash-link" href="#error-stacks" title="Direct link to heading">#</a></h4><p>提案建议将 <code>Error.prototype.stack</code> 作为标准，这对错误上报与分析特别有用，强烈支持。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="do-expressions"></a><a href="https://gist.github.com/dherman/1c97dfb25179fa34a41b5fff040f9879" target="_blank" rel="noopener noreferrer">do expressions</a><a class="hash-link" href="#do-expressions" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><div tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword control-flow" style="color:#e3116c">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;</span><span class="token plain">nav</span><span class="token operator" style="color:rgb(0, 92, 197)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;</span><span class="token maybe-class-name">Home</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">/</span><span class="token operator" style="color:rgb(0, 92, 197)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#e3116c">do</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#e3116c">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">loggedIn</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">          </span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;</span><span class="token maybe-class-name">LogoutButton</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">/</span><span class="token operator" style="color:rgb(0, 92, 197)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#e3116c">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">          </span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;</span><span class="token maybe-class-name">LoginButton</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">/</span><span class="token operator" style="color:rgb(0, 92, 197)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;</span><span class="token operator" style="color:rgb(0, 92, 197)">/</span><span class="token plain">nav</span><span class="token operator" style="color:rgb(0, 92, 197)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><code>jsx</code> 再也不用写得超长了，<code>styled-components</code> 中被诟病的分支判断难以阅读的问题也会烟消云散，因为我们有 <code>do</code>!</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="realms"></a><a href="https://github.com/tc39/proposal-realms" target="_blank" rel="noopener noreferrer">Realms</a><a class="hash-link" href="#realms" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><div tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">let</span><span class="token plain"> realm </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(227, 98, 9)">Realm</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">let</span><span class="token plain"> outerGlobal </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token dom variable" style="color:rgb(156, 220, 254)">window</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">let</span><span class="token plain"> innerGlobal </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> realm</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">global</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">let</span><span class="token plain"> f </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> realm</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">evalScript</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;(function() { return 17 })&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token function" style="color:rgb(111, 66, 193)">f</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">===</span><span class="token plain"> </span><span class="token number">17</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// true</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token known-class-name class-name" style="color:rgb(227, 98, 9)">Reflect</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">getPrototypeOf</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">f</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">===</span><span class="token plain"> outerGlobal</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token class-name" style="color:rgb(227, 98, 9)">Function</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">prototype</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// false</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token known-class-name class-name" style="color:rgb(227, 98, 9)">Reflect</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">getPrototypeOf</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">f</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">===</span><span class="token plain"> innerGlobal</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token class-name" style="color:rgb(227, 98, 9)">Function</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">prototype</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// true</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><code>Realms</code> 提供了 global 环境的隔离，eval 执行代码时不再会污染全局，简直是测试的福利，脑洞很大。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="temporal"></a><a href="https://github.com/maggiepint/proposal-temporal" target="_blank" rel="noopener noreferrer">Temporal</a><a class="hash-link" href="#temporal" title="Direct link to heading">#</a></h4><p>与 <code>Date</code> 类似，但功能更强：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><div tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">var</span><span class="token plain"> ldt </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(227, 98, 9)">temporal</span><span class="token class-name punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token class-name" style="color:rgb(227, 98, 9)">LocalDateTime</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">2017</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">12</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">31</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">23</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">59</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">var</span><span class="token plain"> ldt </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(227, 98, 9)">temporal</span><span class="token class-name punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token class-name" style="color:rgb(227, 98, 9)">LocalDateTime</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">2017</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">12</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">31</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">23</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">59</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> options</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">var</span><span class="token plain"> ldt </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(227, 98, 9)">temporal</span><span class="token class-name punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token class-name" style="color:rgb(227, 98, 9)">LocalDateTime</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">2017</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">12</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">31</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">23</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">59</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">59</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">var</span><span class="token plain"> ldt </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(227, 98, 9)">temporal</span><span class="token class-name punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token class-name" style="color:rgb(227, 98, 9)">LocalDateTime</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">2017</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">12</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">31</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">23</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">59</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">59</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> options</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">var</span><span class="token plain"> ldt </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(227, 98, 9)">temporal</span><span class="token class-name punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token class-name" style="color:rgb(227, 98, 9)">LocalDateTime</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">2017</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">12</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">31</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">23</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">59</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">59</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">123</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">var</span><span class="token plain"> ldt </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(227, 98, 9)">temporal</span><span class="token class-name punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token class-name" style="color:rgb(227, 98, 9)">LocalDateTime</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">2017</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">12</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">31</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">23</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">59</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">59</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">123</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> options</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">var</span><span class="token plain"> ldt </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(227, 98, 9)">temporal</span><span class="token class-name punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token class-name" style="color:rgb(227, 98, 9)">LocalDateTime</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">2017</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">12</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">31</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">23</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">59</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">59</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">123</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">456789</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">var</span><span class="token plain"> ldt </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(227, 98, 9)">temporal</span><span class="token class-name punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token class-name" style="color:rgb(227, 98, 9)">LocalDateTime</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">2017</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">12</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">31</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">23</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">59</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">59</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">123</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">456789</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> options</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// add/subtract time  (Dec 31 2017 23:00 + 2h = Jan 1 2018 01:00)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">var</span><span class="token plain"> addHours </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(227, 98, 9)">temporal</span><span class="token class-name punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token class-name" style="color:rgb(227, 98, 9)">LocalDateTime</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">2017</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">12</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">31</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">23</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">00</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">add</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">2</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token string">&#x27;hours&#x27;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// add/subtract months  (Mar 31 - 1M = Feb 28)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">var</span><span class="token plain"> addMonths </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(227, 98, 9)">temporal</span><span class="token class-name punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token class-name" style="color:rgb(227, 98, 9)">LocalDateTime</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">2017</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token number">03</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token number">31</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">subtract</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token string">&#x27;months&#x27;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// add/subtract years  (Feb 29 2020 - 1Y = Feb 28 2019)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">var</span><span class="token plain"> subtractYears </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(227, 98, 9)">temporal</span><span class="token class-name punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token class-name" style="color:rgb(227, 98, 9)">LocalDateTime</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">2020</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">02</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">29</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">subtract</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token string">&#x27;years&#x27;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>还自带时区转换 api 等等，如果进入草案，可以放弃 moment 这个重量级库了。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="float16-on-typedarrays-dataview-mathhfround"></a><a href="https://docs.google.com/presentation/d/1Ta_IbravBUOvu7LUhlN49SvLU-8G8bIQnsS08P3Z4vY/edit?usp=sharing" target="_blank" rel="noopener noreferrer">Float16 on TypedArrays, DataView, Math.hfround</a><a class="hash-link" href="#float16-on-typedarrays-dataview-mathhfround" title="Direct link to heading">#</a></h4><p>由于大多数 WebGL 纹理需要半精度以上的浮点数计算，推荐了 4 个 api：</p><ul><li>Float16Array</li><li>DataView.prototype.getFloat16</li><li>DataView.prototype.setFloat16</li><li>Math.hfround(x)</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="atomicswaitnonblocking"></a><a href="https://github.com/lars-t-hansen/moz-sandbox/blob/master/sab/waitNonblocking.md" target="_blank" rel="noopener noreferrer">Atomics.waitNonblocking</a><a class="hash-link" href="#atomicswaitnonblocking" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><div tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">var</span><span class="token plain"> sab </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(227, 98, 9)">SharedArrayBuffer</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">4096</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">var</span><span class="token plain"> ia </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(227, 98, 9)">Int32Array</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">sab</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">ia</span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token number">37</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token number">0x1337</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token function" style="color:rgb(111, 66, 193)">test1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">test1</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token maybe-class-name">Atomics</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">waitNonblocking</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">ia</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">37</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">0x1337</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">1000</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">then</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token keyword" style="color:#e3116c">function</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token parameter">r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token console class-name" style="color:rgb(227, 98, 9)">console</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">log</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Resolved: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">+</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">test2</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">var</span><span class="token plain"> code </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string">`</span><span class="token template-string string"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token template-string string">var ia = null;</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token template-string string">onmessage = function (ev) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token template-string string">  if (!ia) {</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token template-string string">    console.log(&quot;Aux worker is running&quot;);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token template-string string">    ia = new Int32Array(ev.data);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token template-string string">  }</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token template-string string">  console.log(&quot;Aux worker is sleeping for a little bit&quot;);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token template-string string">  setTimeout(function () { console.log(&quot;Aux worker is waking&quot;); Atomics.wake(ia, 37); }, 1000);</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token template-string string">}</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">test2</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token keyword" style="color:#e3116c">var</span><span class="token plain"> w </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(227, 98, 9)">Worker</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;data:application/javascript,&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">+</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">encodeURIComponent</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">code</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  w</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">postMessage</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">sab</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token maybe-class-name">Atomics</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">waitNonblocking</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">ia</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">37</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">0x1337</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">then</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token keyword" style="color:#e3116c">function</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token parameter">r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token console class-name" style="color:rgb(227, 98, 9)">console</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">log</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Resolved: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">+</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">test3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">w</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">test3</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token parameter">w</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  w</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">postMessage</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token boolean" style="color:rgb(0, 92, 197)">false</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token maybe-class-name">Atomics</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">waitNonblocking</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">ia</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">37</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">0x1337</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">then</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token keyword" style="color:#e3116c">function</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token parameter">r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token console class-name" style="color:rgb(227, 98, 9)">console</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">log</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Resolved 1: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">+</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token maybe-class-name">Atomics</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">waitNonblocking</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">ia</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">37</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">0x1337</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">then</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token keyword" style="color:#e3116c">function</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token parameter">r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token console class-name" style="color:rgb(227, 98, 9)">console</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">log</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Resolved 2: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">+</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token maybe-class-name">Atomics</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">waitNonblocking</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">ia</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">37</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">0x1337</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">then</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token keyword" style="color:#e3116c">function</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token parameter">r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token console class-name" style="color:rgb(227, 98, 9)">console</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">log</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;Resolved 3: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">+</span><span class="token plain"> r</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>该 api 可以在多线程操作中，有顺序的操作同一个内存地址，如上代码变量 <code>ia</code> 虽然在多线程中执行，但每个线程都会等资源释放后再继续执行。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="numeric-separators"></a><a href="https://github.com/tc39/proposal-numeric-separator" target="_blank" rel="noopener noreferrer">Numeric separators</a><a class="hash-link" href="#numeric-separators" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><div tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token number">1_000_000_000</span><span class="token plain">           </span><span class="token comment" style="color:rgb(106, 153, 85)">// Ah, so a billion</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token number">101_475_938.38</span><span class="token plain">          </span><span class="token comment" style="color:rgb(106, 153, 85)">// And this is hundreds of millions</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">let</span><span class="token plain"> fee </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token number">123_00</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">       </span><span class="token comment" style="color:rgb(106, 153, 85)">// $123 (12300 cents, apparently)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">let</span><span class="token plain"> fee </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token number">12_300</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">       </span><span class="token comment" style="color:rgb(106, 153, 85)">// $12,300 (woah, that fee!)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">let</span><span class="token plain"> amount </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token number">12345_00</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// 12,345 (1234500 cents, apparently)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">let</span><span class="token plain"> amount </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token number">123_4500</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// 123.45 (4-fixed financial)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">let</span><span class="token plain"> amount </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token number">1_234_500</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// 1,234,500</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>提案希望 js 支持分隔符使大数字阅读性更好（不影响计算），很多语言都有实现，很人性化。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="4-总结"></a>4 总结<a class="hash-link" href="#4-总结" title="Direct link to heading">#</a></h2><p>每个草案都觉得很靠谱，涉及语义化、无障碍、性能、拓展语法、连接 nodejs 等方面，虽然部分提案<a href="http://www.yinwang.org/blog-cn/2013/04/18/language-design-mistake2" target="_blank" rel="noopener noreferrer">从语言设计角度是错误的</a>，但 js 运行在网页端，涉及到人机交互、网络加载等问题，遇到的问题自然比任何语言都要复杂，每个提案都是从实践中出发，相信这种道路是正确的。</p><p>由于篇幅与时间限制，stage0 的提案等下次再讨论。特别提一点，stage0 的 <a href="https://github.com/tc39/proposal-cancellation" target="_blank" rel="noopener noreferrer">Cancellation API</a> 很值得大家关注，取消异步操作是人心所向，大势所趋啊。</p><p>感谢所有参与讨论的同学，你们的支持会转化为我们的动力，每周更新，风雨无阻。</p><blockquote><p>讨论地址是：<a href="https://github.com/dt-fe/weekly/issues/21" target="_blank" rel="noopener noreferrer">精读《TC39, ECMAScript, and the Future of JavaScript》 · Issue #21 · dt-fe/weekly</a></p></blockquote><blockquote><p>如果你想参与讨论，请<a href="https://github.com/dt-fe/weekly" target="_blank" rel="noopener noreferrer">点击这里</a>，每周都有新的主题，每周五发布。</p></blockquote><blockquote><p>访问 <a href="https://github.com/dt-fe/weekly/blob/master/15.%E7%B2%BE%E8%AF%BB%20TC39%20%E4%B8%8E%20ECMAScript%20%E6%8F%90%E6%A1%88.md" target="_blank" rel="noopener noreferrer">原始文章地址</a> , 获得更好阅读效果。</p></blockquote></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/coder-study-room/Front-end-Advanced-Route/edit/master/weekly/015.精读 TC39 与 ECMAScript 提案.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col text--right"><em><small>Last updated on <time datetime="2021-04-08T06:04:48.000Z" class="lastUpdatedDate_1WI_">4/8/2021</time> by <strong>wangweidong</strong></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/weekly/014"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« 014.精读架构设计之 DCI</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/weekly/016"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">016.CSS Animations vs Web Animations API »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-引言" class="table-of-contents__link">1 引言</a></li><li><a href="#2-内容概要" class="table-of-contents__link">2 内容概要</a><ul><li><a href="#tc39-是什么？包括哪些人？" class="table-of-contents__link">TC39 是什么？包括哪些人？</a></li><li><a href="#为什么会出现这样一个组织？" class="table-of-contents__link">为什么会出现这样一个组织？</a></li><li><a href="#tc39-这群人主要的工作是什么？" class="table-of-contents__link">TC39 这群人主要的工作是什么？</a></li><li><a href="#标准的流程是什么样的？" class="table-of-contents__link">标准的流程是什么样的？</a></li><li><a href="#一般可以去哪里查看-tc39-标准的进程呢？" class="table-of-contents__link">一般可以去哪里查看 TC39 标准的进程呢？</a></li><li><a href="#我们怎么在程序中应用这些新特性呢？" class="table-of-contents__link">我们怎么在程序中应用这些新特性呢？</a></li></ul></li><li><a href="#3-精读" class="table-of-contents__link">3 精读</a><ul><li><a href="#31-stage-4-大家庭" class="table-of-contents__link">3.1 Stage 4 大家庭</a></li><li><a href="#32-stage-3-大家庭" class="table-of-contents__link">3.2 Stage 3 大家庭</a></li><li><a href="#33-stage2-大家庭" class="table-of-contents__link">3.3 Stage2 大家庭</a></li><li><a href="#34-stage1-大家庭" class="table-of-contents__link">3.4 Stage1 大家庭</a></li></ul></li><li><a href="#4-总结" class="table-of-contents__link">4 总结</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">社区</h4><ul class="footer__items"><li class="footer__item"><a href="https://juejin.cn/user/149189280672616" target="_blank" rel="noopener noreferrer" class="footer__link-item">掘金</a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">程序员自习室</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">更多</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="https://docusaurus.io/img/oss_logo.png" alt="程序员自习室开源" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="https://docusaurus.io/img/oss_logo.png" alt="程序员自习室开源" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></div><div class="footer__copyright">Copyright © 2021 程序员自习室 <a href="https://beian.miit.gov.cn/" target="_blank">粤ICP备17131802号</a></div></div></div></footer></div>
<script src="/assets/js/styles.dfb6e608.js"></script>
<script src="/assets/js/runtime~main.4390b31f.js"></script>
<script src="/assets/js/main.a607b355.js"></script>
<script src="/assets/js/1.1d30cd56.js"></script>
<script src="/assets/js/2.ea8a615f.js"></script>
<script src="/assets/js/3.1e3c85ee.js"></script>
<script src="/assets/js/1be78505.c98b55f0.js"></script>
<script src="/assets/js/224.8da560f1.js"></script>
<script src="/assets/js/cc953bd4.29f0345e.js"></script>
<script src="/assets/js/17896441.21aede54.js"></script>
<script src="/assets/js/1842b0fb.0ee7a239.js"></script>
</body>
</html>