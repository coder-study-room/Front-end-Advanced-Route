<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.72">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="前端进阶导航(2021版) Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="前端进阶导航(2021版) Blog Atom Feed"><title data-react-helmet="true">129. 精读《React Conf 2019 - Day2》 🦖 前端进阶导航(2021版)</title><meta data-react-helmet="true" property="og:url" content="https://coder-study-room.github.io/weekly/129"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-weekly-current"><meta data-react-helmet="true" property="og:title" content="129. 精读《React Conf 2019 - Day2》 🦖 前端进阶导航(2021版)"><meta data-react-helmet="true" name="description" content="1 引言"><meta data-react-helmet="true" property="og:description" content="1 引言"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://coder-study-room.github.io/weekly/129"><link data-react-helmet="true" rel="alternate" href="https://coder-study-room.github.io/weekly/129" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://coder-study-room.github.io/weekly/129" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.f86f321e.css">
<link rel="preload" href="/assets/js/styles.b3f043dc.js" as="script">
<link rel="preload" href="/assets/js/runtime~main.41f64a67.js" as="script">
<link rel="preload" href="/assets/js/main.fb8f3d2b.js" as="script">
<link rel="preload" href="/assets/js/1.46fdb85d.js" as="script">
<link rel="preload" href="/assets/js/2.37941b87.js" as="script">
<link rel="preload" href="/assets/js/3.8e957956.js" as="script">
<link rel="preload" href="/assets/js/1be78505.4595a7b1.js" as="script">
<link rel="preload" href="/assets/js/397.3ed54396.js" as="script">
<link rel="preload" href="/assets/js/cc953bd4.972fd30a.js" as="script">
<link rel="preload" href="/assets/js/17896441.136bed3d.js" as="script">
<link rel="preload" href="/assets/js/333c6bbc.b007526f.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_2qcr"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="Front-end Advanced Route Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.svg" alt="Front-end Advanced Route Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">前端进阶导航(2021版)</strong></a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link">前端学习</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/">前端进阶</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/weekly/">前端精读</a></li></ul></div><a class="navbar__item navbar__link" href="/interview/">前端面试</a></div><div class="navbar__items navbar__items--right"><a href="https://juejin.cn/user/149189280672616/posts" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">掘金</a><a href="https://www.itdongdong.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">博客</a><a href="https://www.aliyun.com/minisite/goods?userCode=656jmlbm" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">阿里云2折</a><a href="https://github.com/coder-study-room/Front-end-Advanced-Route" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_GrZ2"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="Front-end Advanced Route Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.svg" alt="Front-end Advanced Route Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">前端进阶导航(2021版)</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a role="button" class="menu__link menu__link--sublist">前端学习</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/">前端进阶</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/weekly/">前端精读</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/interview/">前端面试</a></li><li class="menu__list-item"><a href="https://juejin.cn/user/149189280672616/posts" target="_blank" rel="noopener noreferrer" class="menu__link">掘金</a></li><li class="menu__list-item"><a href="https://www.itdongdong.com" target="_blank" rel="noopener noreferrer" class="menu__link">博客</a></li><li class="menu__list-item"><a href="https://www.aliyun.com/minisite/goods?userCode=656jmlbm" target="_blank" rel="noopener noreferrer" class="menu__link">阿里云2折</a></li><li class="menu__list-item"><a href="https://github.com/coder-study-room/Front-end-Advanced-Route" target="_blank" rel="noopener noreferrer" class="menu__link header-github-link" aria-label="GitHub repository"></a></li></ul></div></div></div></nav><div class="main-wrapper main-docs-wrapper"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo sidebarWithHideableNavbar_267A"><a tabindex="-1" class="sidebarLogo_3h0W" href="/"><img src="/img/logo.svg" alt="Front-end Advanced Route Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/logo.svg" alt="Front-end Advanced Route Logo" class="themedImage_1VuW themedImage--dark_hz6m"><strong>前端进阶导航(2021版)</strong></a><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">前端精读</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/">1. 精读 js 模块化发展</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/002">2. 精读模态框的最佳实践</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/003">3. 精读前后端渲染之争</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/004">4. 精读AsyncAwait优越之处</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/005">5. 精读民工叔单页数据流方案</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/006">6. 精读JavaScript错误堆栈处理</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/007">7. 精读 请停止 css-in-js 的行为</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/008">8. 精读入坑React前没有人会告诉你的事</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/009">9. 精读 Immutable 结构共享</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/010">10. 精读Web Components 的困境</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/011">11. 精读前端调试技巧</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/012">12. 精读 React 高阶组件</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/013">13. This 带来的困惑</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/014">14. 精读架构设计之 DCI</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/015">15. 精读 TC39 与 ECMAScript 提案</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/016">16. CSS Animations vs Web Animations API</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/017">17. 精读《如何安全地使用 React context》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/018">18. 精读《设计完美的日期选择器》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/019">19. 精读《最佳前端面试题》及面试官技巧</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/020">20. 精读 《Nestjs 文档》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/021">21. 精读《Web fonts: when you need them, when you don’t》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/022">22. 精读《V8 引擎特性带来的的 JS 性能变化》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/023">23. 精读《API设计原则》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/024">24. 精读《现代 JavaScript 概览》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/025">25. 精读《null &gt;= 0?》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/026">26. 精读加密媒体扩展（Encrypted Media Extensions，EME）</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/027">27. 精读《css-in-js 杀鸡用牛刀》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/028">28. 精读《2017前端性能优化备忘录》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/029">29. 精读《JS 中的内存管理》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/030">30. 精读《Javascript 事件循环与异步》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/031">31. 精读《我不再使用高阶组件》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/032">32. 精读《React Router4.0 进阶概念》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/033">33. 精读《30行js代码创建神经网络》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/034">34. 精读《React 代码整洁之道》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/035">35. 精读《dob - 框架实现》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/036">36. 精读《When You “Git” in Trouble- a Version Control Story》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/037">37. 精读《how we position and what we compare》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/038">38. 精读《dob - 框架使用》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/039">39. 精读《全链路体验浏览器挖矿》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/040">40. 精读《初探 Reason 与 GraphQL》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/041">41. 精读《Ant Design 3.0 背后的故事》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/042">42. 精读《前端数据流哲学》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/043">43. 精读《增强现实与可视化》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/044">44. 精读《Rekit Studio》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/045">45. 精读《React&#x27;s new Context API》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/046">46. 精读《react-rxjs》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/047">47. 精读《webpack4.0 升级指南》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/048">48. 精读《Immer.js》源码</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/049">49. 精读《Compilers are the New Frameworks》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/050">50. 精读《快速上手构建 ARKit 应用》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/051">51. 精读《Elements of Web Dev》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/052">52. 精读《图解 ES 模块》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/053">53. 精读《插件化思维》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/054">54. 精读《在浏览器运行 serverRender》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/055">55. 精读《async await 是把双刃剑》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/056">56. 精读《重新思考 Redux》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/057">57. 精读《现代 js 框架存在的根本原因》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/058">58. 精读《Typescript2.0 - 2.9》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/059">59. 精读《如何利用 Nodejs 监听文件夹》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/060">60. 精读《如何在 nodejs 使用环境变量》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/061">61. 精读《React 八种条件渲染》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/062">62. 精读《JS 引擎基础之 Shapes and Inline Caches》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/063">63. 精读《React 的多态性》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/064">64. 精读《手写 SQL 编译器 - 词法分析》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/065">65. 精读《手写 SQL 编译器 - 文法介绍》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/066">66. 精读《手写 SQL 编译器 - 语法分析》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/067">67. 精读《手写 SQL 编译器 - 回溯》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/068">68. 精读衡量用户体验</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/069">69. 精读《SQL vs Flux》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/070">70. 精读《手写 SQL 编译器 - 语法树》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/071">71. 精读《手写 SQL 编译器 - 错误提示》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/072">72. 精读《REST, GraphQL, Webhooks, &amp; gRPC 如何选型》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/073">73. 精读《sqorn 源码》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/074">74. 精读《12 个评估 JS 库你需要关心的事》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/075">75. 精读《Epitath 源码 - renderProps 新用法》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/076">76. 精读《谈谈 Web Workers》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/077">77. 精读《用 Reduce 实现 Promise 串行执行》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/078">78. 精读《手写 SQL 编译器 - 性能优化之缓存》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/079">79. 精读《React Hooks》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/080">80. 精读《怎么用 React Hooks 造轮子》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/081">81. 精读《使用 CSS 属性选择器》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/082">82. 精读《Htm - Hyperscript 源码》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/083">83. 精读《React16 新特性》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/084">84. 精读《Typescript 3.2 新特性》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/085">85. 精读《手写 SQL 编译器 - 智能提示》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/086">86. 精读《国际化布局 - Logical Properties》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/087">87. 精读《setState 做了什么》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/088">88. 精读《Caches API》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/089">89. 精读《如何编译前端项目与组件》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/090">90. 精读《极客公园 2019》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/091">91. 精读《正则 ES2018》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/092">92. 精读《React PowerPlug 源码》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/093">93. 精读《syntax-parser 源码》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/094">94. 精读《Serverless 给前端带来了什么》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/095">95. 精读《Function VS Class 组件》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/096">96. 精读《useEffect 完全指南》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/097">97. 精读《编写有弹性的组件》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/098">98. 精读《react-easy-state 源码》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/099">99. 精读《Scheduling in React》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/100">100. 精读《V8 引擎 Lazy Parsing》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/101">101. 精读《持续集成 vs 持续交付 vs 持续部署》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/102">102. 精读《Monorepo 的优势》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/103">103. 精读《为什么专家不再关心技术细节》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/104">104. 精读《Function Component 入门》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/105">105. 精读《What&#x27;s new in javascript》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/106">106. 精读《数据之上·智慧之光 - 2018》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/107">107. 精读《Optional chaining》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/108">108. 精读《智能商业》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/109">109. 精读《Vue3.0 Function API》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/110">110. 精读《Inject Instance 源码》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/111">111. 精读《前端未来展望》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/112">112. 精读《源码学习》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/113">113. 精读《Nodejs V12》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/114">114. 精读《谁在世界中心》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/115">115.精读《Tableau 入门》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/116">116. 精读《刷新》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/117">117. 精读《Tableau 探索式模型》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/118">118. 精读《使用 css 变量生成颜色主题》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/119">119. 精读《前端深水区》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/120">120. 精读《React Hooks 最佳实践》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/121">121. 精读《前端与 BI》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/122">122. 精读《robot 源码 - 有限状态机》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/123">123. 精读《用 Babel 创造自定义 JS 语法》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/124">124. 精读《用 css grid 重新思考布局》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/125">125. 精读《深度学习 - 函数式之美》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/126">126. 精读《Nuxtjs》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/127">127. 精读《React Conf 2019 - Day1》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/128">128. 精读《Hooks 取数 - swr 源码》</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/weekly/129">129. 精读《React Conf 2019 - Day2》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/130">130. 精读《unstated 与 unstated-next 源码》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/131">131. 精读《从 0 到 1》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/132">132. 精读《正交的 React 组件》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/133">133. 精读《寻找框架设计的平衡点》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/134">134. 精读《我在阿里数据中台大前端》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/135">135. 精读《极客公园 IFX - 上》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/136">136. 精读《极客公园 IFX - 下》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/137">137. 精读《当我在分享的时候，我在做什么？》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/138">138. 精读《精通 console.log》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/139">139. 精读《手写 JSON Parser》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/140">140. 精读《结合 React 使用原生 Drag Drop API》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/141">141. 精读《useRef 与 createRef 的区别》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/142">142. 精读《如何做好 CodeReview》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/143">143. 精读《Suspense 改变开发方式》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/144">144. 精读《Webpack5 新特性 - 模块联邦》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/145">145. 精读《React Router v6》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/146">146. 精读《React Hooks 数据流》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/147">147. 精读《@types react 值得注意的 TS 技巧》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/148">148. 精读《React Error Boundaries》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/149">149. 精读《React 性能调试》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/150">150. 精读《Deno 1.0 你需要了解的》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/151">151. 精读《@umijs use-request》源码</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/152">152. 精读《recoil》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/153">153. 精读《snowpack》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/154">154. 精读《用 React 做按需渲染》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/155">155. 精读《use-what-changed 源码》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/156">156. 精读《react-intersection-observer 源码》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/157">157. 精读《如何比较 Object 对象》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/158">158. 精读《Typescript 4》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/159">159. 精读《对低代码搭建的理解》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/160">160. 精读《函数缓存》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/161">161. 精读《可视化搭建思考 - 富文本搭建》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/162">162. 精读《Tasks, microtasks, queues and schedules》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/163">163. 精读《Spring 概念》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/164">164. 精读《数据搭建引擎 bi-designer API-设计器》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/165">165. 精读《数据搭建引擎 bi-designer API-组件》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/166">166. 精读《BI 搭建 - 筛选条件》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/167">167. 精读《设计模式 - Abstract Factory 抽象工厂》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/168">168. 精读《设计模式 - Builder 生成器》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/169">169. 精读《设计模式 - Factory Method 工厂方法》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/170">170. 精读《设计模式 - Prototype 原型模式》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/171">171. 精读《设计模式 - Singleton 单例模式》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/172">172. 精读《设计模式 - Adapter 适配器模式》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/173">173. 精读《设计模式 - Bridge 桥接模式》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/174">174. 精读《设计模式 - Composite 组合模式》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/175">175. 精读《设计模式 - Decorator 装饰器模式》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/176">176. 精读《设计模式 - Facade 外观模式》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/177">177. 精读《设计模式 - Flyweight 享元模式》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/178">178. 精读《设计模式 - Proxy 代理模式》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/179">179. 精读《设计模式 - Chain of Responsibility 职责链模式》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/180">180. 精读《设计模式 - Command 命令模式》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/181">181. 精读《设计模式 - Interpreter 解释器模式》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/182">182. 精读《设计模式 - Iterator 迭代器模式》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/183">183. 精读《设计模式 - Mediator 中介者模式》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/184">184. 精读《设计模式 - Memoto 备忘录模式》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/185">185. 精读《设计模式 - Observer 观察者模式》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/186">186. 精读《设计模式 - State 状态模式》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/187">187. 精读《设计模式 - Strategy 策略模式》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/188">188. 精读《设计模式 - Template Method 模版模式》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/189">189. 精读《设计模式 - Visitor 访问者模式》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/190">190. 精读《DOM diff 原理详解》</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/weekly/191">191. 精读《高性能表格》</a></li></ul></li></ul></div><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_1CGd"><svg width="20" height="20" role="img" class="collapseSidebarButtonIcon_3E-R"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="1-引言"></a>1 引言<a class="hash-link" href="#1-引言" title="Direct link to heading">#</a></h2><p>这是继 <a href="https://github.com/dt-fe/weekly/blob/v2/127.%E7%B2%BE%E8%AF%BB%E3%80%8AReact%20Conf%202019%20-%20Day1%E3%80%8B.md" target="_blank" rel="noopener noreferrer">精读《React Conf 2019 - Day1》</a> 之后的第二篇，补充了 React Conf 2019 第二天的内容。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="2-概述--精读"></a>2 概述 &amp; 精读<a class="hash-link" href="#2-概述--精读" title="Direct link to heading">#</a></h2><p>第二天的内容更为精彩，笔者会重点介绍比较干货的部分。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="fast-refresh"></a>Fast refresh<a class="hash-link" href="#fast-refresh" title="Direct link to heading">#</a></h3><p><a href="https://facebook.github.io/react-native/docs/fast-refresh" target="_blank" rel="noopener noreferrer">Fast refresh</a> 是更好的 react-hot-loader 替代方案，目前仅支持 react-native 平台，很快就会支持 react-dom 平台。</p><p>相比不支持 Function component、无法错误恢复、更新经常失灵的 hot reloading 来说，fast refresh 还拥有以下几个优点：</p><ul><li>状态保持。</li><li>支持 Function Component Hooks。</li><li>更快的更新速度。</li></ul><p>Fast refresh 更新速度更快，是基于 Function Component 生成了 “签名”，从而最大成都避免销毁重渲染，尽可能保持对组件的 rerender 刷新。下面介绍签名机制的工作原理。</p><p>Fast refresh 对每个 Function component 都生成了一份专属签名，用以描述这个组件核心状态，当这个核心状态改变时，就只能销毁重渲染了，但对于不触及核心的修改就能进行代价非常小的 rerender。</p><p>这个签名包含了 hooks 和参数名：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token comment" style="color:rgb(106, 153, 85)">// signature: &quot;useState{isLoggedIn}&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">function</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:rgb(111, 66, 193)">ExampleComponent</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain">isLoggedIn</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> setIsLoggedIn</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">useState</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token boolean" style="color:rgb(0, 92, 197)">true</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>比如当参数名变更时，这个组件的逻辑已发生改动，此时只能销毁并重渲染了。因此实际上通过对签名的对比来判断是否要销毁并重刷新组件：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token comment" style="color:rgb(106, 153, 85)">// signature: &quot;useState{isLoggedOut}&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">function</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:rgb(111, 66, 193)">ExampleComponent</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain">isLoggedOut</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> setIsLoggedOut</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">useState</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token boolean" style="color:rgb(0, 92, 197)">true</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>同理，当 hooks 从 <code>useState</code> 改成了 <code>useReducer</code>，签名也会发生变化从而导致彻底的重渲染。</p><p>但除此之外，<strong>比如对样式的修改、Dom 结构的修改都不会触发签名的变化</strong>，从而保证了 “对不触及逻辑的改动进行高效的轻量 renreder”。</p><p>然而 Fast refresh 也有如下局限性：</p><ul><li>还不能友好支持 Class component。</li><li>混合导出 React 和非 React 组件时无法精确的 hot reload。</li><li>更高的内存要求。</li></ul><p>可以看到，Fast Refresh 随着功能推广与内置，现在已经覆盖了 Facebook 95% 以上 hot reload 场景了：</p><p><img src="https://cdn.jsdelivr.net/gh/ViktorWong/imgbed/img/20210409190910.png"></p><p>这部分内容不仅揭开了 hot reload 技术内幕，还对其功能进行了进一步优化，2019 年的 React 开发体系已经进入精细化阶段。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="重写-react-devtools"></a>重写 React devtools<a class="hash-link" href="#重写-react-devtools" title="Direct link to heading">#</a></h3><p>React devtools 的更新终于被正式介绍了，本来笔者以为新的 devtools 只是支持了 hooks，但听完分享后发现还有更多有用的改进，包括：</p><ul><li>更高的性能。</li><li>更多特性支持。</li><li>更好用户体验。</li></ul><p><strong>找到节点渲染链路</strong></p><p>并不是每个 React 节点都参与渲染，新版 React devtools 可以展示出 rendered by：</p><p><img src="https://cdn.jsdelivr.net/gh/ViktorWong/imgbed/img/20210409190932.png"></p><p><strong>调试 Suspense</strong></p><p>在 Day1 中讲到的 Suspense 特性可以在 React devtools 调试了：</p><p><img src="https://cdn.jsdelivr.net/gh/ViktorWong/imgbed/img/20210409190955.png"></p><p>通过点击时钟 icon，可以模拟 Suspense 处于 pendding 或 ready 状态。</p><p><strong>增强调试能力</strong></p><p>可以通过点击直接跳转到组件源码：</p><p><img src="https://cdn.jsdelivr.net/gh/ViktorWong/imgbed/img/20210409191011.png"></p><p>最新版已增强至点击按钮后直接通过 Source 打开源码位置，<strong>这样可以快速通过 UI 寻找到代码</strong>。同时还可以看到，通过点击 debugger 按钮将当前组件信息打到控制台调试。</p><p>除此之外还可以动态修改组件的 props 与 hook state，大大增强了调试能力。</p><p><strong>profiler</strong></p><p>分析工具也得到了增强，现在可以看到每个组件被渲染了几次以及重新渲染的原因：</p><p><img src="https://cdn.jsdelivr.net/gh/ViktorWong/imgbed/img/20210409191028.png"></p><p>比如上图组件被渲染了 4 次，主要有两个原因：Hooks 改变与 Props 改变。</p><p>除此之外，还优化了更多细节体验，比如高亮搜索、HOC 的展示优化、嵌套层级过多时不会占用过多的横向宽度等等。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="react-codemod"></a>react codemod<a class="hash-link" href="#react-codemod" title="Direct link to heading">#</a></h3><p>codemod 是一个代码重构的方式，通过 AST 方式精准触达代码，我们可以认为 codemod 是一个更聪明的“查找/替换”。</p><p>codemod 主要有以下三种使用方式：</p><ul><li>重命名。</li><li>代码排序。</li><li>一定程度的代码替换。</li></ul><p>接下来就讲到 <a href="https://github.com/reactjs/react-codemod" target="_blank" rel="noopener noreferrer">react codemod</a> 了，它是 react 场景的 codemod 解决方案，facebook 是这么使用 react codemod 的：</p><ul><li>迁移 facebook 代码。</li><li>涉及几万个组件。</li><li>修复了 3500 个文件的 React.PropTypes。</li><li>修复了 8500 个文件的生命周期 unsafe。</li><li>修复了 20000 个文件的 createClass 转 JSX。</li></ul><p>使用方式：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><div tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">npx react-codemod React-PropTypes-to-prop-types</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>可以看到，通过 cli 对文件进行一次性重构处理。除此之外，再列举几种使用场景：</p><ul><li>create-element-to-jsx 将 <code>React.createElement</code> 转换为 JSX。</li><li>error-boundaries 将 <code>unstable_handleError</code> 改为 <code>componentDidCatch</code>。</li><li>findDOMNode 将 <code>React.createClass</code> 中 <code>this.getDOMNode()</code> 改为 <code>React.findDOMNode</code>。</li><li>sort-comp 将 Class Component 生命周期按照规范排序，<a href="https://github.com/yannickcr/eslint-plugin-react/blob/master/docs/rules/sort-comp.md" target="_blank" rel="noopener noreferrer">eslint-plugin-react</a> 插件也有相同能力。</li></ul><p>理论上来讲，所有 codemode 做的事情都可以替换为 eslint 的 autofix 来完成，比如 sort-comp 就同时被 codemode 和 eslint 支持。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="suspense"></a>Suspense<a class="hash-link" href="#suspense" title="Direct link to heading">#</a></h3><p>要理解 Suspense，就要理解 Suspense 与普通 loading 有什么区别。</p><p>从代码角度来说，Suspense 可以类比为 <code>try/catch</code> 的体验。为了简化代码复杂度，我们可以用 <code>try/catch</code> 包裹代码，从而简化 try 区块代码复杂度，并将兜底代码放在 catch 区块：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword control-flow" style="color:#e3116c">try</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// 只要考虑正确情况</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#e3116c">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// 错误时 fallback</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Suspense 也一样，它在渲染 React 组件时如果遇到了 Promise 抛出的 Error，就会进入 <code>fallback</code>，所以 <code>fallback</code> 含义是 Loading 中状态：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jsx"><div tabindex="0" class="prism-code language-jsx codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token tag punctuation" style="color:rgb(36, 41, 46)">&lt;</span><span class="token tag class-name" style="color:rgb(227, 98, 9)">Suspense</span><span class="token tag" style="color:rgb(78, 201, 176)"> </span><span class="token tag attr-name" style="color:rgb(156, 220, 254)">fallback</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(36, 41, 46)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token tag script language-javascript tag punctuation" style="color:rgb(36, 41, 46)">&lt;</span><span class="token tag script language-javascript tag class-name" style="color:rgb(227, 98, 9)">Spinner</span><span class="token tag script language-javascript tag" style="color:rgb(78, 201, 176)"> </span><span class="token tag script language-javascript tag punctuation" style="color:rgb(36, 41, 46)">/&gt;</span><span class="token tag script language-javascript punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token tag punctuation" style="color:rgb(36, 41, 46)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(36, 41, 46)">&lt;</span><span class="token tag class-name" style="color:rgb(227, 98, 9)">ProfilePage</span><span class="token tag" style="color:rgb(78, 201, 176)"> </span><span class="token tag punctuation" style="color:rgb(36, 41, 46)">/&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(36, 41, 46)">&lt;/</span><span class="token tag class-name" style="color:rgb(227, 98, 9)">Suspense</span><span class="token tag punctuation" style="color:rgb(36, 41, 46)">&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>与此同时，实际业务组件中的取数也不需要担心取数是否正在进行中，只要直接处理拿到数据的情况就好了：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jsx"><div tabindex="0" class="prism-code language-jsx codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">ProfileDetails</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// 直接使用 user，不用担心失败。</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> user </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> resource</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">user</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token function" style="color:rgb(111, 66, 193)">read</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token keyword" style="color:#e3116c">return</span><span class="token plain"> </span><span class="token tag punctuation" style="color:rgb(36, 41, 46)">&lt;</span><span class="token tag" style="color:rgb(78, 201, 176)">h1</span><span class="token tag punctuation" style="color:rgb(36, 41, 46)">&gt;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain">user</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">name</span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token tag punctuation" style="color:rgb(36, 41, 46)">&lt;/</span><span class="token tag" style="color:rgb(78, 201, 176)">h1</span><span class="token tag punctuation" style="color:rgb(36, 41, 46)">&gt;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>进一步的，如果要处理组件渲染的异常，再使用 <code>ErrorBoundary</code> 包裹即可，此时的 <code>fallback</code> 含义是组件加载异常的错误状态：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jsx"><div tabindex="0" class="prism-code language-jsx codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">Home</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token parameter">props</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token keyword" style="color:#e3116c">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(36, 41, 46)">&lt;</span><span class="token tag class-name" style="color:rgb(227, 98, 9)">ErrorBoundary</span><span class="token tag" style="color:rgb(78, 201, 176)"> </span><span class="token tag attr-name" style="color:rgb(156, 220, 254)">fallback</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(36, 41, 46)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token tag script language-javascript tag punctuation" style="color:rgb(36, 41, 46)">&lt;</span><span class="token tag script language-javascript tag class-name" style="color:rgb(227, 98, 9)">ErrorMessage</span><span class="token tag script language-javascript tag" style="color:rgb(78, 201, 176)"> </span><span class="token tag script language-javascript tag punctuation" style="color:rgb(36, 41, 46)">/&gt;</span><span class="token tag script language-javascript punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token tag punctuation" style="color:rgb(36, 41, 46)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      </span><span class="token tag punctuation" style="color:rgb(36, 41, 46)">&lt;</span><span class="token tag class-name" style="color:rgb(227, 98, 9)">Suspense</span><span class="token tag" style="color:rgb(78, 201, 176)"> </span><span class="token tag attr-name" style="color:rgb(156, 220, 254)">fallback</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(36, 41, 46)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token tag script language-javascript tag punctuation" style="color:rgb(36, 41, 46)">&lt;</span><span class="token tag script language-javascript tag class-name" style="color:rgb(227, 98, 9)">Placeholder</span><span class="token tag script language-javascript tag" style="color:rgb(78, 201, 176)"> </span><span class="token tag script language-javascript tag punctuation" style="color:rgb(36, 41, 46)">/&gt;</span><span class="token tag script language-javascript punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token tag punctuation" style="color:rgb(36, 41, 46)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(36, 41, 46)">&lt;</span><span class="token tag class-name" style="color:rgb(227, 98, 9)">Composer</span><span class="token tag" style="color:rgb(78, 201, 176)"> </span><span class="token tag punctuation" style="color:rgb(36, 41, 46)">/&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      </span><span class="token tag punctuation" style="color:rgb(36, 41, 46)">&lt;/</span><span class="token tag class-name" style="color:rgb(227, 98, 9)">Suspense</span><span class="token tag punctuation" style="color:rgb(36, 41, 46)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(36, 41, 46)">&lt;/</span><span class="token tag class-name" style="color:rgb(227, 98, 9)">ErrorBoundary</span><span class="token tag punctuation" style="color:rgb(36, 41, 46)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Suspense 模式的取数好处是 “fetch on render”，即渲染与取数同时进行，而普通模式的取数是 “fetch after render”，即渲染完成后再通过 <code>useEffect</code> 取数，此时取数时机已晚。</p><p><strong>队列加载</strong></p><p>假设 <code>Composer</code> 与 <code>NewsFeed</code> 组件内部都通过 <code>useQuery</code> 取数，那么并行取数时加载机制如下：</p><p><img src="https://cdn.jsdelivr.net/gh/ViktorWong/imgbed/img/20210409191050.png"></p><p>这可能有两个问题：组件内部加载顺序不统一与组件间加载顺序不统一。</p><p>如果组件内部有图片，可能图片与组件渲染实际不一致，此时可以利用 Suspense 统一 hold 所有子组件的特性，将图片加载改为 Suspense 模式：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jsx"><div tabindex="0" class="prism-code language-jsx codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token tag punctuation" style="color:rgb(36, 41, 46)">&lt;</span><span class="token tag" style="color:rgb(78, 201, 176)">div</span><span class="token tag punctuation" style="color:rgb(36, 41, 46)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(36, 41, 46)">&lt;</span><span class="token tag class-name" style="color:rgb(227, 98, 9)">YourImage</span><span class="token tag" style="color:rgb(78, 201, 176)"> </span><span class="token tag attr-name" style="color:rgb(156, 220, 254)">src</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(36, 41, 46)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token tag script language-javascript" style="color:rgb(78, 201, 176)">uri</span><span class="token tag script language-javascript punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token tag" style="color:rgb(78, 201, 176)"> </span><span class="token tag attr-name" style="color:rgb(156, 220, 254)">alt</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(36, 41, 46)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token tag script language-javascript operator" style="color:rgb(0, 92, 197)">...</span><span class="token tag script language-javascript punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token tag" style="color:rgb(78, 201, 176)"> </span><span class="token tag punctuation" style="color:rgb(36, 41, 46)">/&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(36, 41, 46)">&lt;</span><span class="token tag class-name" style="color:rgb(227, 98, 9)">MoreComposer</span><span class="token tag" style="color:rgb(78, 201, 176)"> </span><span class="token tag punctuation" style="color:rgb(36, 41, 46)">/&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(36, 41, 46)">&lt;/</span><span class="token tag" style="color:rgb(78, 201, 176)">div</span><span class="token tag punctuation" style="color:rgb(36, 41, 46)">&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>同一个 Suspense 可以等待所有子元素都 Ready 后才会一把渲染出 UI，因此可以看到网页被一次性刷新而不是分部刷新。</p><p>第二个问题是组件间加载顺序不统一，可能导致先渲染了文章内容，再渲染出文章头部，此时如果区块高度不固定，文章头部可能会撑开，导致文章内容下移，用户的阅读体验会遭到打断。可以通过 <code>suspense ordering</code> 解决这个问题：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jsx"><div tabindex="0" class="prism-code language-jsx codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">Home</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token parameter">props</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token keyword" style="color:#e3116c">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(36, 41, 46)">&lt;</span><span class="token tag class-name" style="color:rgb(227, 98, 9)">SuspenseList</span><span class="token tag" style="color:rgb(78, 201, 176)"> </span><span class="token tag attr-name" style="color:rgb(156, 220, 254)">revealOrder</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(36, 41, 46)">=</span><span class="token tag attr-value punctuation" style="color:rgb(36, 41, 46)">&quot;</span><span class="token tag attr-value" style="color:rgb(78, 201, 176)">forwards</span><span class="token tag attr-value punctuation" style="color:rgb(36, 41, 46)">&quot;</span><span class="token tag punctuation" style="color:rgb(36, 41, 46)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      </span><span class="token tag punctuation" style="color:rgb(36, 41, 46)">&lt;</span><span class="token tag class-name" style="color:rgb(227, 98, 9)">Suspense</span><span class="token tag" style="color:rgb(78, 201, 176)"> </span><span class="token tag attr-name" style="color:rgb(156, 220, 254)">fallback</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(36, 41, 46)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token tag script language-javascript tag punctuation" style="color:rgb(36, 41, 46)">&lt;</span><span class="token tag script language-javascript tag class-name" style="color:rgb(227, 98, 9)">ComposerFallback</span><span class="token tag script language-javascript tag" style="color:rgb(78, 201, 176)"> </span><span class="token tag script language-javascript tag punctuation" style="color:rgb(36, 41, 46)">/&gt;</span><span class="token tag script language-javascript punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token tag punctuation" style="color:rgb(36, 41, 46)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(36, 41, 46)">&lt;</span><span class="token tag class-name" style="color:rgb(227, 98, 9)">Composer</span><span class="token tag" style="color:rgb(78, 201, 176)"> </span><span class="token tag punctuation" style="color:rgb(36, 41, 46)">/&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      </span><span class="token tag punctuation" style="color:rgb(36, 41, 46)">&lt;/</span><span class="token tag class-name" style="color:rgb(227, 98, 9)">Suspense</span><span class="token tag punctuation" style="color:rgb(36, 41, 46)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      </span><span class="token tag punctuation" style="color:rgb(36, 41, 46)">&lt;</span><span class="token tag class-name" style="color:rgb(227, 98, 9)">Suspense</span><span class="token tag" style="color:rgb(78, 201, 176)"> </span><span class="token tag attr-name" style="color:rgb(156, 220, 254)">fallback</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(36, 41, 46)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token tag script language-javascript tag punctuation" style="color:rgb(36, 41, 46)">&lt;</span><span class="token tag script language-javascript tag class-name" style="color:rgb(227, 98, 9)">FeedFallback</span><span class="token tag script language-javascript tag" style="color:rgb(78, 201, 176)"> </span><span class="token tag script language-javascript tag punctuation" style="color:rgb(36, 41, 46)">/&gt;</span><span class="token tag script language-javascript punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token tag punctuation" style="color:rgb(36, 41, 46)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(36, 41, 46)">&lt;</span><span class="token tag class-name" style="color:rgb(227, 98, 9)">NewsFeed</span><span class="token tag" style="color:rgb(78, 201, 176)"> </span><span class="token tag punctuation" style="color:rgb(36, 41, 46)">/&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      </span><span class="token tag punctuation" style="color:rgb(36, 41, 46)">&lt;/</span><span class="token tag class-name" style="color:rgb(227, 98, 9)">Suspense</span><span class="token tag punctuation" style="color:rgb(36, 41, 46)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(36, 41, 46)">&lt;/</span><span class="token tag class-name" style="color:rgb(227, 98, 9)">SuspenseList</span><span class="token tag punctuation" style="color:rgb(36, 41, 46)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>比如 <code>forwards</code> 表示从上到下，那么一定会先渲染头部再渲染文章内容，这样文章内容就不会都抖动了。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="render-as-you-fetch"></a>Render as you fetch<a class="hash-link" href="#render-as-you-fetch" title="Direct link to heading">#</a></h3><p>相比 “fetch on render”，更高级别的优化是 “Render as you fetch”，即取数在渲染时机之前。</p><p>比如页面路由的跳转、Hover 到一个区块，此时如果取数由这个动作触发，就可以再次将取数时机提前，Facebook 为此创造了一个新的 Hook：<code>usePreloadedQuery</code>。</p><p>用法是，在某个事件中取数，比如点击页面跳转按钮时，通过 <code>preloadQuery</code> 预取数，得到的结果并不是取数结果，而是一个标识，在渲染组件中，把这个标识传给 <code>usePreloadedQuery</code> 可以拿到真实取数结果：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token comment" style="color:rgb(106, 153, 85)">// 组件 A 的 onClick</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> reference </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">preloadQuery</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">query</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> variables</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// 组件 B 的 render</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> data </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">usePreloadedQuery</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">query</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> reference</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>可以看到，取数真正触发的时机在渲染函数执行之前，所以在 <code>usePreloadedQuery</code> 调用时取数肯定已经在路上，甚至已经完成。相比之下，普通的 <code>useQuery</code> 函数存在下面几个问题：</p><ul><li>由于取数过程存在状态变化，可能导致组件在 “取数无意义” 状态下重新渲染多次。</li><li>可能取数还未完成就触发重渲染。<ul><li>没有取消的机制，没有清除结果的机制。</li></ul></li><li>没有办法唯一标识组件。</li></ul><p>preloadQuery 的好处就是将取数时机与 UI 分离，这样可以更细粒度的控制逻辑：</p><ul><li>调用 preloadQuery 时：<ul><li>在组件销毁时取消取数。</li><li>有新取数触发时取消取数。</li><li>销毁一些轮询机制。</li></ul></li><li>渲染组件调用 usePreloadedQuery 时：<ul><li>不会再触发取数，不会触发意外的 re-render。</li><li>不需要清空，因为取数不在这里发起。</li><li>不需要清理轮询。</li></ul></li></ul><p>可见 preloadQuery 相比 useQuery 的确有了一些体验提升，然而这个优化比较追求极致，对大部分国内项目来说可能还走不到 facebook 这么极致的性能优化，所以投入产出比显得不是那么高，而且这个开发方式对开发者不是太友好，因为它让请求的时机割裂到两个模块中。</p><p>但毕竟用户体验是大于开发者体验的，React 尽量通过提高开发者体验来间接提高用户体验，使双方都满意，但像 preloadQuery 就无法两者兼顾了，为了用户体验可以适当的降低一些开发者体验。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="如何维护代码"></a>如何维护代码<a class="hash-link" href="#如何维护代码" title="Direct link to heading">#</a></h3><p>这个分享讲述了如何提升代码维护效率，毕竟一个月后可能连自己写的代码都看不懂了。<a href="http://github.com/hydrosquall" target="_blank" rel="noopener noreferrer">hydrosquall</a> 通过类比地图的方式解释了程序员是如何维护代码的。</p><p>首先看我们是如何认路的。认路分为三个层次：</p><ul><li>随意走走。<ul><li>通过一些地标判断方向。</li></ul></li><li>有方向的寻路。<ul><li>通过跟随同伴或者了解更多本地信息找到目的地。</li></ul></li><li>地图。<ul><li>通过 GPS 定位。</li><li>通过模拟地图方式指出路线。</li></ul></li></ul><p>可以看到这三种方式是逐层递进的，那么类比到代码就有意思了：</p><ul><li>随意走走（滚动查看源代码 + ctrl/f 查找代码 + grep 搜索）。<ul><li>入口（找到入口节点，查看数据结构）。</li><li>标记（查看代码注释、查看 README）。</li><li>发信号弹（断点、console.log 等调试行为）</li></ul></li><li>找到方向。<ul><li>git blame 查看 owner，或直接根据文档找到 codeowners。</li></ul></li><li>地图。<ul><li>幸运的话你可以找到一份架构流程图。</li></ul></li></ul><p>可以看到，地图有几种抽象层次，比如忽略了细节的纽约地铁线路图：</p><p><img src="https://cdn.jsdelivr.net/gh/ViktorWong/imgbed/img/20210409191113.png"></p><p>或者是包含丰富地面信息的地铁线路图：</p><p><img src="https://cdn.jsdelivr.net/gh/ViktorWong/imgbed/img/20210409191135.png"></p><p>抽象到什么层次取决于用户使用的场景，那么代码抽象也是如此。<a href="http://github.com/hydrosquall" target="_blank" rel="noopener noreferrer">hydrosquall</a> 做了一个工具自动分析出代码调用关系：<a href="https://github.com/persper/js-callgraph" target="_blank" rel="noopener noreferrer">js-callgraph</a></p><p><img src="https://cdn.jsdelivr.net/gh/ViktorWong/imgbed/img/20210409191158.png"></p><p>这就像路牌一样，可以更高效的看出代码结构，也包括了数据流结构，由于篇幅限制，感兴趣的同学可以看 <a href="https://youtu.be/JDDxR1a15Yo?t=6579" target="_blank" rel="noopener noreferrer">原视频</a> 了解更多。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="写作与写代码"></a>写作与写代码<a class="hash-link" href="#写作与写代码" title="Direct link to heading">#</a></h3><p>本章讲了写作（小说）与写代码的关联，总结出如下几个重点：</p><ul><li>写小说和写代码都是创造行为。</li><li>写代码需要抽象思维，写小说也要有抽象思维构造人物和情节。</li><li>Show, don&#x27;t tell，写作天然就是申明式的，和数据驱动很相似。</li></ul><p>更多可以去看 <a href="https://youtu.be/JDDxR1a15Yo?t=9135" target="_blank" rel="noopener noreferrer">原视频</a>。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="移动端动画最佳实践"></a>移动端动画最佳实践<a class="hash-link" href="#移动端动画最佳实践" title="Direct link to heading">#</a></h3><p>首先要使用一个真实的手机设备调试，否则可能出现 PC Chrome 一切正常，而手机上实际效果性能很差的情况！</p><p><strong>手势下拉退出</strong></p><p>利用 <a href="https://github.com/react-spring/react-spring" target="_blank" rel="noopener noreferrer">react-spring</a> 和 <a href="https://www.npmjs.com/package/react-use-gesture" target="_blank" rel="noopener noreferrer">react-use-gesture</a> 做一个下滑消失的 Demo：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jsx"><div tabindex="0" class="prism-code language-jsx codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> animated</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> useSpring </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">from</span><span class="token plain"> </span><span class="token string">&quot;react-spring&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> useDrag </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">from</span><span class="token plain"> </span><span class="token string">&quot;react-use-gesture&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> y </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> set</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">useSpring</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  y</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>首先定义一个 <code>y</code> 纵向位置，通过 <code>useDrag</code> 将拖拽操作与 UI 绑定，通过回调将其与 <code>y</code> 数据绑定：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> bind </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">useDrag</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token parameter"> last</span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token parameter"> movement</span><span class="token parameter operator" style="color:rgb(0, 92, 197)">:</span><span class="token parameter"> </span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token parameter"> movementY</span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token parameter"> memo </span><span class="token parameter operator" style="color:rgb(0, 92, 197)">=</span><span class="token parameter"> y</span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token parameter">value </span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(0, 92, 197)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#e3116c">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">last</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// 拖拽结束时，如果偏移量超过 50 则效果和结束一样，直接将 y 设置为 100</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> notificationClosed </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> movementY </span><span class="token operator" style="color:rgb(0, 92, 197)">&gt;</span><span class="token plain"> </span><span class="token number">50</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#e3116c">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">set</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      y</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> notificationClosed </span><span class="token operator" style="color:rgb(0, 92, 197)">?</span><span class="token plain"> </span><span class="token number">100</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      onReset</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> notificationClosed </span><span class="token operator" style="color:rgb(0, 92, 197)">&amp;&amp;</span><span class="token plain"> removeNotification</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// y 的位置区间在 0～100</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token function" style="color:rgb(111, 66, 193)">set</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> y</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">clamp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">100</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> memo </span><span class="token operator" style="color:rgb(0, 92, 197)">+</span><span class="token plain"> movementY</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#e3116c">return</span><span class="token plain"> memo</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>将 <code>useDrag</code> 与 <code>y</code> 绑定后，就可以用在 UI 组件上了：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jsx"><div tabindex="0" class="prism-code language-jsx codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token tag punctuation" style="color:rgb(36, 41, 46)">&lt;</span><span class="token tag class-name" style="color:rgb(227, 98, 9)">StyledNotification</span><span class="token tag" style="color:rgb(78, 201, 176)"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token tag" style="color:rgb(78, 201, 176)">  </span><span class="token tag attr-name" style="color:rgb(156, 220, 254)">as</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(36, 41, 46)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token tag script language-javascript" style="color:rgb(78, 201, 176)">animated</span><span class="token tag script language-javascript punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token tag script language-javascript" style="color:rgb(78, 201, 176)">div</span><span class="token tag script language-javascript punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token tag" style="color:rgb(78, 201, 176)"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token tag" style="color:rgb(78, 201, 176)">  </span><span class="token tag attr-name" style="color:rgb(156, 220, 254)">onTouchStart</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(36, 41, 46)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token tag script language-javascript function" style="color:rgb(111, 66, 193)">bind</span><span class="token tag script language-javascript punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token tag script language-javascript punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token tag script language-javascript punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token tag script language-javascript" style="color:rgb(78, 201, 176)">onTouchStart</span><span class="token tag script language-javascript punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token tag" style="color:rgb(78, 201, 176)"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token tag" style="color:rgb(78, 201, 176)">  </span><span class="token tag attr-name" style="color:rgb(156, 220, 254)">style</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(36, 41, 46)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token tag script language-javascript punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token tag script language-javascript" style="color:rgb(78, 201, 176)"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token tag script language-javascript" style="color:rgb(78, 201, 176)">    opacity</span><span class="token tag script language-javascript operator" style="color:rgb(0, 92, 197)">:</span><span class="token tag script language-javascript" style="color:rgb(78, 201, 176)"> y</span><span class="token tag script language-javascript punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token tag script language-javascript function" style="color:rgb(111, 66, 193)">interpolate</span><span class="token tag script language-javascript punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token tag script language-javascript punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token tag script language-javascript number" style="color:rgb(78, 201, 176)">0</span><span class="token tag script language-javascript punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token tag script language-javascript" style="color:rgb(78, 201, 176)"> </span><span class="token tag script language-javascript number" style="color:rgb(78, 201, 176)">100</span><span class="token tag script language-javascript punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token tag script language-javascript punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token tag script language-javascript" style="color:rgb(78, 201, 176)"> </span><span class="token tag script language-javascript punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token tag script language-javascript number" style="color:rgb(78, 201, 176)">1</span><span class="token tag script language-javascript punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token tag script language-javascript" style="color:rgb(78, 201, 176)"> </span><span class="token tag script language-javascript number" style="color:rgb(78, 201, 176)">0</span><span class="token tag script language-javascript punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token tag script language-javascript punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token tag script language-javascript punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token tag script language-javascript" style="color:rgb(78, 201, 176)"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token tag script language-javascript" style="color:rgb(78, 201, 176)">    transform</span><span class="token tag script language-javascript operator" style="color:rgb(0, 92, 197)">:</span><span class="token tag script language-javascript" style="color:rgb(78, 201, 176)"> y</span><span class="token tag script language-javascript punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token tag script language-javascript function" style="color:rgb(111, 66, 193)">interpolate</span><span class="token tag script language-javascript punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token tag script language-javascript parameter" style="color:rgb(78, 201, 176)">y</span><span class="token tag script language-javascript" style="color:rgb(78, 201, 176)"> </span><span class="token tag script language-javascript operator" style="color:rgb(0, 92, 197)">=&gt;</span><span class="token tag script language-javascript" style="color:rgb(78, 201, 176)"> </span><span class="token tag script language-javascript template-string template-punctuation string" style="color:rgb(78, 201, 176)">`</span><span class="token tag script language-javascript template-string string" style="color:rgb(78, 201, 176)">translateY(</span><span class="token tag script language-javascript template-string interpolation interpolation-punctuation punctuation" style="color:rgb(36, 41, 46)">${</span><span class="token tag script language-javascript template-string interpolation" style="color:rgb(78, 201, 176)">y</span><span class="token tag script language-javascript template-string interpolation interpolation-punctuation punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token tag script language-javascript template-string string" style="color:rgb(78, 201, 176)">px)</span><span class="token tag script language-javascript template-string template-punctuation string" style="color:rgb(78, 201, 176)">`</span><span class="token tag script language-javascript punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token tag script language-javascript" style="color:rgb(78, 201, 176)"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token tag script language-javascript" style="color:rgb(78, 201, 176)">  </span><span class="token tag script language-javascript punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token tag script language-javascript punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token tag" style="color:rgb(78, 201, 176)"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token tag" style="color:rgb(78, 201, 176)"></span><span class="token tag punctuation" style="color:rgb(36, 41, 46)">/&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>将 <code>opacity</code> 与 <code>transform</code> 与位置 <code>y</code> 绑定就可以做出下拉消失的效果。</p><p><strong>滑动的洞见</strong></p><p>接着讲到了滑动的三个洞见：</p><ol><li>要立刻响应，任何延迟都会造成用户额外精神负担。</li><li>滚动速度衰减可以提升用户体验:</li></ol><p><img src="https://cdn.jsdelivr.net/gh/ViktorWong/imgbed/img/20210409191613.gif"></p><p>接着我们需要预测用户的意图，比如在一个类似微信消息列表页左右滑动时：</p><ul><li>是否想取消手势交互？</li><li>是否想展示出更多交互按钮？</li><li>是否想删除所有内容？</li></ul><p>这需要更多设计思考。</p><ol><li>橡皮筋滚动，即列表页可以一直向下拉，上面部分像橡皮筋一样可以被拉出空白页的效果。</li></ol><p>在设计手势动画时要考虑三个要点：</p><ul><li>使用移动增量作为手势动画的基准点。</li><li>动画和手势应该随时可以被中断，通过 springs 即可实现。</li><li>完成手势后的动画速度应该与手势速度相当，这样视觉体验更自然。</li></ul><p>最后提到了动画兼容性与性能，比如尽量只使用 <code>transform</code> 与 <code>opacity</code> 可以保证移动端的流畅度，不同移动设备的默认手势效果不同，最好通过 <code>touch-action</code> 禁用默认行为以达到更好的兼容性与效果。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="唱片与-react"></a>唱片与 React<a class="hash-link" href="#唱片与-react" title="Direct link to heading">#</a></h3><p>J.Dash 拥有十年软件开发经验，同时也卖过很多唱片，他介绍了唱片行业与软件开发的共同点。</p><p>唱片行业需要音乐编排能力，这与编码能力类似，都存在良好的设计模式，并且需要团队合作，开发过程中会遇到一些痛苦的经历，但最终完成音乐和项目时都会获得满足的喜悦。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="函数式编程"></a>函数式编程<a class="hash-link" href="#函数式编程" title="Direct link to heading">#</a></h3><blockquote><p>Declaratives UIs are the future, and the future is Comonadic. - Phil Freeman</p></blockquote><p>申明式 UI 是未来，未来则是 Comonadic。</p><p>所谓申明式 UI 可以用下面的公式表达：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">type </span><span class="token function-variable function" style="color:rgb(111, 66, 193)">render</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token parameter">state</span><span class="token parameter operator" style="color:rgb(0, 92, 197)">:</span><span class="token parameter"> State</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(0, 92, 197)">=&gt;</span><span class="token plain"> </span><span class="token maybe-class-name">View</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>然后用一段公式介绍了 Comonadic：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(227, 98, 9)">Functor</span><span class="token plain"> </span><span class="token parameter">w</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(0, 92, 197)">=&gt;</span><span class="token plain"> </span><span class="token maybe-class-name">Comonad</span><span class="token plain"> w where</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  extract   </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> w a </span><span class="token operator" style="color:rgb(0, 92, 197)">-</span><span class="token operator" style="color:rgb(0, 92, 197)">&gt;</span><span class="token plain"> a</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  duplicate </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> w a </span><span class="token operator" style="color:rgb(0, 92, 197)">-</span><span class="token operator" style="color:rgb(0, 92, 197)">&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">w</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">w a</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  extend    </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">w a </span><span class="token operator" style="color:rgb(0, 92, 197)">-</span><span class="token operator" style="color:rgb(0, 92, 197)">&gt;</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">-</span><span class="token operator" style="color:rgb(0, 92, 197)">&gt;</span><span class="token plain"> w a </span><span class="token operator" style="color:rgb(0, 92, 197)">-</span><span class="token operator" style="color:rgb(0, 92, 197)">&gt;</span><span class="token plain"> w b</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>用 JS 版本做一个解释：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name" style="color:rgb(111, 66, 193)">Store</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token parameter"> state</span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token parameter"> render </span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(0, 92, 197)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token function-variable function" style="color:rgb(111, 66, 193)">extend</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token parameter">f</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(0, 92, 197)">=&gt;</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:rgb(111, 66, 193)">Store</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> state</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token function-variable function" style="color:rgb(111, 66, 193)">render</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(0, 92, 197)">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">f</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function maybe-class-name" style="color:rgb(111, 66, 193)">Store</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> state</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> render </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token function-variable function" style="color:rgb(111, 66, 193)">extract</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(0, 92, 197)">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">render</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><code>extract</code> 调用后会进行申明式渲染 UI，即 <code>render(state)</code>。</p><p><code>extend</code> 表示拓展，接收一个拓展函数作为参数，返回一个新的 Store 对象。这个拓展函数可以拿到 <code>state</code>、<code>render</code> 并返回新的 <code>state</code> 作为 <code>extract</code> 时 <code>render</code> 的输入。使用例子是这样的：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jsx"><div tabindex="0" class="prism-code language-jsx codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> App </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">Store</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  state</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> msg</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token string">&quot;World&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token function-variable function" style="color:rgb(111, 66, 193)">render</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token parameter"> msg </span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=&gt;</span><span class="token plain"> </span><span class="token tag punctuation" style="color:rgb(36, 41, 46)">&lt;</span><span class="token tag" style="color:rgb(78, 201, 176)">p</span><span class="token tag punctuation" style="color:rgb(36, 41, 46)">&gt;</span><span class="token plain">Hello </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain">msg</span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token tag punctuation" style="color:rgb(36, 41, 46)">&lt;/</span><span class="token tag" style="color:rgb(78, 201, 176)">p</span><span class="token tag punctuation" style="color:rgb(36, 41, 46)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">App</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token function" style="color:rgb(111, 66, 193)">extend</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token parameter"> state </span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  state</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">msg </span><span class="token operator" style="color:rgb(0, 92, 197)">===</span><span class="token plain"> </span><span class="token string">&quot;World&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">?</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> msg</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token string">&quot;ReactConf&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> state</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token function" style="color:rgb(111, 66, 193)">extract</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// &lt;p&gt; Hello ReactConf &lt;/p&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>然而尴尬的是，笔者看了很久也没看懂 <code>Store</code> 函数，最后运行了一下发现这个 Demo 抛出了异常 😂。</p><p>下面是笔者稍微修改后的例子，至少能跑起来：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name" style="color:rgb(111, 66, 193)">Store</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token parameter"> state</span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token parameter"> render </span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(0, 92, 197)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token function-variable function" style="color:rgb(111, 66, 193)">extend</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token parameter">f</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(0, 92, 197)">=&gt;</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:rgb(111, 66, 193)">Store</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> state</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token function-variable function" style="color:rgb(111, 66, 193)">render</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(0, 92, 197)">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">render</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">f</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> state</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> render </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token function-variable function" style="color:rgb(111, 66, 193)">extract</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(0, 92, 197)">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">render</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> app </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:rgb(111, 66, 193)">Store</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  state</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> msg</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token string">&quot;Hello World&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token function-variable function" style="color:rgb(111, 66, 193)">render</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token parameter"> msg </span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(0, 92, 197)">=&gt;</span><span class="token plain"> </span><span class="token console class-name" style="color:rgb(227, 98, 9)">console</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">log</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;render &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">+</span><span class="token plain"> msg</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">app</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">extend</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token parameter"> state </span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(0, 92, 197)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#e3116c">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> msg</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">msg</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">+</span><span class="token plain"> </span><span class="token string">&quot; extend1&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">extend</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token parameter"> state </span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(0, 92, 197)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#e3116c">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> msg</span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token property-access" style="color:rgb(111, 66, 193)">msg</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">+</span><span class="token plain"> </span><span class="token string">&quot; extend2&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token method function property-access" style="color:rgb(111, 66, 193)">extract</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)">// render Hello World extend2 extend1</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>然而作者的意思仍是未解之谜，希望对函数式了解的同学可以在评论区指点一下。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="wick-editor"></a>wick editor<a class="hash-link" href="#wick-editor" title="Direct link to heading">#</a></h3><p><a href="https://www.wickeditor.com/" target="_blank" rel="noopener noreferrer">wick editor</a> 是一个开源的动画、游戏制作软件。</p><p>wick editor 是一个动画制作工具，但拓展了一些 js 编程能力，因此可以很好的将动画与游戏结合在一起：</p><p><img src="https://cdn.jsdelivr.net/gh/ViktorWong/imgbed/img/20210409191259.png"></p><p>演讲介绍了 wick editor 的演化过程：</p><p>从很简陋的 MVP 版本开始（1 周）</p><p><img src="https://cdn.jsdelivr.net/gh/ViktorWong/imgbed/img/20210409191326.png"></p><p>到 Pre-Alpha（4 月）</p><p><img src="https://cdn.jsdelivr.net/gh/ViktorWong/imgbed/img/20210409191342.png"></p><p>Alpha（5 月）</p><p><img src="https://cdn.jsdelivr.net/gh/ViktorWong/imgbed/img/20210409191355.png"></p><p>Beta（1.5 年）</p><p><img src="https://cdn.jsdelivr.net/gh/ViktorWong/imgbed/img/20210409191410.png"></p><p>重点是 1.0 版本采用 React 重写了！继 Beta 之后又经历了 1 年：</p><p><img src="https://cdn.jsdelivr.net/gh/ViktorWong/imgbed/img/20210409191423.png"></p><p>这个团队最棒的地方是，将游戏与教育结合，针对不同场景做了很多用户调研并根据反馈持续改进。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="react-select"></a>React Select<a class="hash-link" href="#react-select" title="Direct link to heading">#</a></h3><p><a href="https://github.com/JedWatson/react-select" target="_blank" rel="noopener noreferrer">react-select</a> 的作者 <a href="https://github.com/JedWatson" target="_blank" rel="noopener noreferrer">Jed Watson</a> 被请来啦。作为一个看上去很简单组件（select）的开发者，却拥有如此大的关注量（1.8w star），那作者有着怎样的心路历程呢？</p><p>react-select 看似简单的名字背后其实有挺多的功能，比如作者列举了一些功能层面的内容：</p><ul><li>autocomplete - 输入时搜索。</li><li>单、多选。</li><li>focus 管理。</li><li>下拉框层级与位置，比如可以放在根 DOM 节点，也可以作为当前节点的子元素。</li><li>异步下拉框内容。</li><li>键盘、触控。</li><li>Createble，即在搜索时如果没有内容可以动态创建。</li><li>等等。</li></ul><p><img src="https://cdn.jsdelivr.net/gh/ViktorWong/imgbed/img/20210409191436.png"></p><p>在设计层面：</p><ul><li>申明式。</li><li>可以被定制。</li><li>性能要求。</li><li>等等。</li></ul><p>随着 Star 逐渐上涨，越来越多的需求被提出，核心库代码量越来越大，甚至许多需求之间都是相互冲突的，而且作者每天都会被上百个 Issue 与 PR 吵醒。做一个业务 Select 可能只要 5 分钟，但做一个开源 Select 却要 5 年，原因是一个简单的 Select 如何满足所有不同业务场景？这绝对是个巨大的挑战。</p><p>比如用户即需要受控也要非受控的组件，如何满足好这个需求同时又让代码更可维护呢？</p><p>假设我们拥有一个受控的组件 <code>SelectComponent</code>，那么它的主要 props 是 <code>value</code> 与 <code>onChange</code>，如果要拓展成一个既支持 <code>defaultValue</code>（非受控）又支持 <code>value</code>（受控）的组件，我们可以创建一个 <code>manageState</code> 组件对 <code>SelectComponent</code> 进行封装：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jsx"><div tabindex="0" class="prism-code language-jsx codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:rgb(111, 66, 193)">manageState</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token parameter">SelectComponent</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token parameter"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token parameter">  value</span><span class="token parameter operator" style="color:rgb(0, 92, 197)">:</span><span class="token parameter"> valueProps</span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token parameter"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token parameter">  onChange</span><span class="token parameter operator" style="color:rgb(0, 92, 197)">:</span><span class="token parameter"> onChangeProp</span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token parameter"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token parameter">  defaultValue</span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token parameter"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token parameter">  </span><span class="token parameter operator" style="color:rgb(0, 92, 197)">...</span><span class="token parameter">props</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token parameter"></span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain">valueState</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> setValue</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">useState</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">defaultValue</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> value </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> valueProps </span><span class="token operator" style="color:rgb(0, 92, 197)">!==</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">undefined</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">?</span><span class="token plain"> valueProps </span><span class="token operator" style="color:rgb(0, 92, 197)">:</span><span class="token plain"> valueState</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:rgb(111, 66, 193)">onChange</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token parameter">newValue</span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token parameter"> actionMeta</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token keyword" style="color:#e3116c">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token keyword" style="color:#e3116c">typeof</span><span class="token plain"> onChangeProp </span><span class="token operator" style="color:rgb(0, 92, 197)">===</span><span class="token plain"> </span><span class="token string">&quot;function&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      </span><span class="token function" style="color:rgb(111, 66, 193)">onChangeProp</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">newValue</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> actionMeta</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token function" style="color:rgb(111, 66, 193)">setValue</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">newValue</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token keyword" style="color:#e3116c">return</span><span class="token plain"> </span><span class="token tag punctuation" style="color:rgb(36, 41, 46)">&lt;</span><span class="token tag class-name" style="color:rgb(227, 98, 9)">SelectComponent</span><span class="token tag" style="color:rgb(78, 201, 176)"> </span><span class="token tag spread punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token tag spread punctuation" style="color:rgb(36, 41, 46)">...</span><span class="token tag spread attr-value" style="color:rgb(78, 201, 176)">props</span><span class="token tag spread punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token tag" style="color:rgb(78, 201, 176)"> </span><span class="token tag attr-name" style="color:rgb(156, 220, 254)">value</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(36, 41, 46)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token tag script language-javascript" style="color:rgb(78, 201, 176)">value</span><span class="token tag script language-javascript punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token tag" style="color:rgb(78, 201, 176)"> </span><span class="token tag attr-name" style="color:rgb(156, 220, 254)">onChange</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(36, 41, 46)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token tag script language-javascript" style="color:rgb(78, 201, 176)">onChange</span><span class="token tag script language-javascript punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token tag punctuation" style="color:rgb(36, 41, 46)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>这样就可以组合为一个受控/非受控的综合 Select 组件：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword module" style="color:#e3116c">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">BaseSelect</span><span class="token plain"> </span><span class="token keyword module" style="color:#e3116c">from</span><span class="token plain"> </span><span class="token string">&quot;./Select&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword module" style="color:#e3116c">import</span><span class="token plain"> </span><span class="token imports">manageState</span><span class="token plain"> </span><span class="token keyword module" style="color:#e3116c">from</span><span class="token plain"> </span><span class="token string">&quot;./manageState&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword module" style="color:#e3116c">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#e3116c">default</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">manageState</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token maybe-class-name">Select</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>同理对异步的封装也可以放在 <code>makeAsync</code> 函数中：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jsx"><div tabindex="0" class="prism-code language-jsx codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:rgb(111, 66, 193)">makeAsync</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token parameter">SelectComponent</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token parameter"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token parameter">  getOptions</span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token parameter"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token parameter">  defaultOptions</span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token parameter"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token parameter">  </span><span class="token parameter operator" style="color:rgb(0, 92, 197)">...</span><span class="token parameter">props</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token parameter"></span><span class="token parameter punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain">options</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> setOptions</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">useState</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">defaultOptions</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain">isLoading</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> setIsLoading</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">useState</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token boolean" style="color:rgb(0, 92, 197)">false</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:rgb(111, 66, 193)">onInputChange</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">async</span><span class="token plain"> </span><span class="token parameter">newValue</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token function" style="color:rgb(111, 66, 193)">setIsLoading</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token boolean" style="color:rgb(0, 92, 197)">true</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> newOptions </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">await</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">getOptions</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">newValue</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token function" style="color:rgb(111, 66, 193)">setIsLoading</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token boolean" style="color:rgb(0, 92, 197)">false</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token function" style="color:rgb(111, 66, 193)">setOptions</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">newOptions</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token keyword" style="color:#e3116c">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(36, 41, 46)">&lt;</span><span class="token tag class-name" style="color:rgb(227, 98, 9)">SelectComponent</span><span class="token tag" style="color:rgb(78, 201, 176)"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token tag" style="color:rgb(78, 201, 176)">      </span><span class="token tag spread punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token tag spread punctuation" style="color:rgb(36, 41, 46)">...</span><span class="token tag spread attr-value" style="color:rgb(78, 201, 176)">props</span><span class="token tag spread punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token tag" style="color:rgb(78, 201, 176)"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token tag" style="color:rgb(78, 201, 176)">      </span><span class="token tag attr-name" style="color:rgb(156, 220, 254)">options</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(36, 41, 46)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token tag script language-javascript" style="color:rgb(78, 201, 176)">options</span><span class="token tag script language-javascript punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token tag" style="color:rgb(78, 201, 176)"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token tag" style="color:rgb(78, 201, 176)">      </span><span class="token tag attr-name" style="color:rgb(156, 220, 254)">isLoading</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(36, 41, 46)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token tag script language-javascript" style="color:rgb(78, 201, 176)">isLoading</span><span class="token tag script language-javascript punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token tag" style="color:rgb(78, 201, 176)"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token tag" style="color:rgb(78, 201, 176)">      </span><span class="token tag attr-name" style="color:rgb(156, 220, 254)">onInputChange</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(36, 41, 46)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token tag script language-javascript" style="color:rgb(78, 201, 176)">onInputChange</span><span class="token tag script language-javascript punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token tag" style="color:rgb(78, 201, 176)"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token tag" style="color:rgb(78, 201, 176)">    </span><span class="token tag punctuation" style="color:rgb(36, 41, 46)">/&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>可以看到，<code>SelectComponent</code> 是一个完全受控的数据驱动的 UI，无论是 <code>manageState</code> 还是 <code>makeAsync</code> 都是对数据处理的拓展，所以这三者之间才可以融洽的组合：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword module" style="color:#e3116c">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">BaseSelect</span><span class="token plain"> </span><span class="token keyword module" style="color:#e3116c">from</span><span class="token plain"> </span><span class="token string">&quot;./Select&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword module" style="color:#e3116c">import</span><span class="token plain"> </span><span class="token imports">manageState</span><span class="token plain"> </span><span class="token keyword module" style="color:#e3116c">from</span><span class="token plain"> </span><span class="token string">&quot;./manageState&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword module" style="color:#e3116c">import</span><span class="token plain"> </span><span class="token imports">makeAsync</span><span class="token plain"> </span><span class="token keyword module" style="color:#e3116c">from</span><span class="token plain"> </span><span class="token string">&quot;./async&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword module" style="color:#e3116c">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#e3116c">default</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">manageState</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token maybe-class-name">Select</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword module" style="color:#e3116c">export</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> </span><span class="token maybe-class-name">AsyncSelect</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">manageState</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token function" style="color:rgb(111, 66, 193)">makeAsync</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token maybe-class-name">Select</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>后面还有一些风格化、开源协作的思考，这里就不展开了，对这部分感兴趣的同学可以查看原视频了解更多。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="react--政府财政透明项目"></a>React + 政府财政透明项目<a class="hash-link" href="#react--政府财政透明项目" title="Direct link to heading">#</a></h3><p>usaspending.gov 这个网站使用 React 建设，可以查看美国政府支持财政的明细，通过流畅的体验让更多用户可以了解国家财政支出，进一步推动财政支出的透明化。由于并不涉及前端技术的介绍，主要是产品介绍，因此精读就不详细展开了。</p><p>顺便说一句，智能分析数据就用 <a href="https://www.alibabacloud.com/zh/product/quickbi" target="_blank" rel="noopener noreferrer">QuickBI</a>，QuickBI 是我们团队研发的一款智能 BI 服务平台，如果你将美国政府的财政支持作为数据集输入，你会分析得更透彻。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="react--星舰模拟器"></a>React + 星舰模拟器<a class="hash-link" href="#react--星舰模拟器" title="Direct link to heading">#</a></h3><p>最后介绍的是使用 React 制作的星舰模拟器，看上去像一个游戏：</p><p><img src="https://cdn.jsdelivr.net/gh/ViktorWong/imgbed/img/20210409191454.png"></p><p>有星系图、船体、驾驶员信息、武器装备、燃料、通信等等内容。甚至可以模拟太空驾驶，进行任务，可以实时多人协同。对太空迷们的吸引力很大，感兴趣的同学建议直接观看 <a href="https://youtu.be/JDDxR1a15Yo?t=28638" target="_blank" rel="noopener noreferrer">视频</a>。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="3-总结"></a>3 总结<a class="hash-link" href="#3-总结" title="Direct link to heading">#</a></h2><p>第二天的内容非常全面，涉及了 React API、开发者周边、codemod 工具、代码维护、写作/音乐与代码、动画、函数式编程、看似简单的 React 组件、使用 React 制作的各种脑洞大开的项目，等等。</p><p>React Conf 要展示的是一个完整的 React 世界，第一天提到了 React 是一个桥梁，正因为这个桥梁，连接了各行各业不同的人群以及不同的项目，大家都有一个共同的语言：React。</p><p>&quot;We not only react code, but react the world&quot;。</p><blockquote><p>讨论地址是：<a href="https://github.com/dt-fe/weekly/issues/217" target="_blank" rel="noopener noreferrer">精读《React Conf 2019 - Day2》 · Issue #217 · dt-fe/weekly</a></p></blockquote><p><strong>如果你想参与讨论，请 <a href="https://github.com/dt-fe/weekly" target="_blank" rel="noopener noreferrer">点击这里</a>，每周都有新的主题，周末或周一发布。前端精读 - 帮你筛选靠谱的内容。</strong></p><blockquote><p>版权声明：自由转载-非商用-非衍生-保持署名（<a href="https://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh" target="_blank" rel="noopener noreferrer">创意共享 3.0 许可证</a>）</p></blockquote></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/coder-study-room/Front-end-Advanced-Route/edit/master/weekly/129.精读《React Conf 2019 - Day2》.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col text--right"><em><small>Last updated on <time datetime="2021-04-12T02:08:19.000Z" class="lastUpdatedDate_1WI_">4/12/2021</time> by <strong>wangweidong</strong></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/weekly/128"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« 128. 精读《Hooks 取数 - swr 源码》</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/weekly/130"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">130. 精读《unstated 与 unstated-next 源码》 »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-引言" class="table-of-contents__link">1 引言</a></li><li><a href="#2-概述--精读" class="table-of-contents__link">2 概述 &amp; 精读</a><ul><li><a href="#fast-refresh" class="table-of-contents__link">Fast refresh</a></li><li><a href="#重写-react-devtools" class="table-of-contents__link">重写 React devtools</a></li><li><a href="#react-codemod" class="table-of-contents__link">react codemod</a></li><li><a href="#suspense" class="table-of-contents__link">Suspense</a></li><li><a href="#render-as-you-fetch" class="table-of-contents__link">Render as you fetch</a></li><li><a href="#如何维护代码" class="table-of-contents__link">如何维护代码</a></li><li><a href="#写作与写代码" class="table-of-contents__link">写作与写代码</a></li><li><a href="#移动端动画最佳实践" class="table-of-contents__link">移动端动画最佳实践</a></li><li><a href="#唱片与-react" class="table-of-contents__link">唱片与 React</a></li><li><a href="#函数式编程" class="table-of-contents__link">函数式编程</a></li><li><a href="#wick-editor" class="table-of-contents__link">wick editor</a></li><li><a href="#react-select" class="table-of-contents__link">React Select</a></li><li><a href="#react--政府财政透明项目" class="table-of-contents__link">React + 政府财政透明项目</a></li><li><a href="#react--星舰模拟器" class="table-of-contents__link">React + 星舰模拟器</a></li></ul></li><li><a href="#3-总结" class="table-of-contents__link">3 总结</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="https://docusaurus.io/img/oss_logo.png" alt="程序员自习室开源" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="https://docusaurus.io/img/oss_logo.png" alt="程序员自习室开源" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></div><div class="footer__copyright">Copyright © 2021 程序员自习室 <a href="https://beian.miit.gov.cn/" target="_blank">粤ICP备17131802号</a></div></div></div></footer></div>
<script src="/assets/js/styles.b3f043dc.js"></script>
<script src="/assets/js/runtime~main.41f64a67.js"></script>
<script src="/assets/js/main.fb8f3d2b.js"></script>
<script src="/assets/js/1.46fdb85d.js"></script>
<script src="/assets/js/2.37941b87.js"></script>
<script src="/assets/js/3.8e957956.js"></script>
<script src="/assets/js/1be78505.4595a7b1.js"></script>
<script src="/assets/js/397.3ed54396.js"></script>
<script src="/assets/js/cc953bd4.972fd30a.js"></script>
<script src="/assets/js/17896441.136bed3d.js"></script>
<script src="/assets/js/333c6bbc.b007526f.js"></script>
</body>
</html>